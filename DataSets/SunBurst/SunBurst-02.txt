SolarWinds: Advancing the Story Executive Summary The Russian espionage campaign that compromised the SolarWinds supply chain is progressing, yet public-facing research into the campaign is not. That’s in part because piecing together what happened so far is exceptionally challenging. The threat actor, identified by the U.S. government as APT29 but tracked in the private industry as UNC2452, took great pains to avoid creating the type of patterns that make tracing them easy. For months, the Russians successfully compromised or blinded the very security companies and government agencies most likely to pursue them. This report aims to provide tactical intelligence to advance the understanding of this campaign and enable better and faster incident response. RiskIQ’s unique vantagepoint and collection of internet telemetry enabled its new intelligence analysis team, RiskIQ's Team Atlas, to illuminate a larger portion of this particular threat actor’s infrastructure. Key Findings The network infrastructure footprint of the SolarWinds espionage campaign is significantly larger than previously identified in U.S. government and private industry reporting. With high confidence, RiskIQ’s Team Atlas detected an additional 18 servers that likely communicated with the targeted, secondary Cobalt Strike payloads via TEARDROP and RAINDROP. This represented a 56% increase in the size of the adversary’s known command-and-control footprint and will likely lead to newly identified targets. RiskIQ notified US-CERT of the findings prior to publication. RiskIQ's Team Atlas's discoveries suggest that efforts to advance the investigation into the SolarWinds espionage campaign beyond the second, more targeted stage were inhibited by two main factors: The use of U.S.-based infrastructure in the first stage, which effectively blocked or limited pursuit by the NSA; and Highly skilled measures to avoid creating patterns typically identified and tracked by threat hunters. Atlas identified patterns where others did not, due to its unique data collection and analytic capabilities. Background and Prior Research: The Story So Far “SolarWinds” is shorthand for an ongoing espionage campaign delivered primarily via a technology software supply chain compromise in the United States. The moniker was derived from the first attack vector to come to light: malicious exploitation of an update patch in the SolarWinds Orion software, a common tool used to manage IT infrastructure. In December, FireEye, itself a SolarWinds customer, announced that it was a victim of the campaign in an SEC filing and public blog. Days later, FireEye published its initial research into the identified malware, which sparked a series of public-facing threat reports and briefings from Microsoft, Volexity, Symantec, Crowdstrike, the United States government, SolarWinds, and others. These reports established what was known so far about this campaign, most of it derived through detailed analysis of the malware used. Reporting indicated that no later than September of 2019, the threat actor compromised SolarWinds through unknown means and introduced a backdoor called SUNBURST into an Orion software update. SolarWinds stated that only updates released between March and June of 2020 were backdoored. The U.S. government indicated that products from other supply chain software companies were also likely exploited, including Fortinet, Zimbra, Pulse Secure, Citrix, and VMWare. An estimated 16,000 organizations received the malicious SolarWinds update, according to the U.S government. Anne Neuberger, Deputy National Security Advisor for Cyber and Emerging Technology, said nine federal agencies and 100 private sector companies were impacted, implying they received follow-on, targeted malware. In Congressional testimony, Brad Smith of Microsoft said 60 of its customers were targeted, including four foreign governments. This suggests that despite initial alarm over the unusually wide and seemingly indiscriminate reach of the backdoored software update, the campaign was, in fact, highly targeted. Analysis of the first stage used in the campaign confirmed that assessment. SUNBURST had many features and capabilities that were never used, a sign that the threat actor was not interested in stealing data from all of its first-stage victims. Of the SUNBURST features that were operationalized, the most telling was that which identified Antivirus (AV) and Endpoint Detection & Response (EDR) products on the target. SUNBURST was designed to identify, avoid, or disable different security products. This indicated the threat actor was intentionally avoiding infecting systems that were not in the predefined target set, in addition to evading detection. The actor otherwise demonstrated superb technical competence, and it was RiskIQ Team Atlas's assessment that bypassing any individual product was not beyond the group's capabilities. Presumably, the desired targets were running the AV products SUNBURST was designed to disable. Those products were sold by five companies: FireEye, Crowdstrike, Microsoft, ESET, and F-Secure. Notably, these same companies were responsible for all of the substantive, publicly available research into APT29 (Cozy Bear, Dukes), the group traditionally associated with Russia’s foreign intelligence service (SVR). The U.S. government formally attributed the SolarWinds campaign to the SVR and APT29. The exception to that list is Kaspersky, whose researchers previously published extensively on the Dukes, but whose products are made in Russia and currently banned for use in federal agencies by the U.S. government. SUNBURST looked for the presence of Kaspersky products on targets, but did not alter its behavior if identified. The second, follow-on stage of the campaign was initiated by two custom droppers, called TEARDROP (FireEye) and RAINDROP (Symantec), which gave the more narrowly defined target set a modified variant of the commercially available pentesting tool, Cobalt Strike. This malware was designed to enable lateral movement through and mapping of victim networks, as well as the collection of user credentials. The third-stage introduced an implant called GOLDMAX (Microsoft) / SUNSHUTTLE (FireEye) designed for long-term persistence. Its C2 implementation allowed it to blend in with normal network traffic. RiskIQ’s Altas Team identified evidence that it was tested prior to use on the intended targets. We strongly suspect that there were earlier versions of SUNBURST and modified Cobalt Strike payloads that were similarly deployed, and that other later-stage payloads are likely to exist in addition to SIBOT (Microsoft) / MISPRINT. The last significant public-facing research into the SolarWinds campaign published by the private industry came in March of 2021, more than a month prior to this publication. Since then, our collective understanding of the campaign has atrophied, due primarily to the steps taken by the adversary to thwart forensic analysis. These impediments to analysis impact both the tactical and strategic responses to the campaign. Arguably, the most significant strategic impact has been the inability of the security community to definitively attribute the attack, causing the U.S. government to stand alone in attributing the campaign to the Russians. This puts the onus on the government to solely and publicly justify its assessment without pointing to the unclassified sources and methods available to private industry. Indeed, the press reported that the threat actor sent a postcard to the home of FireEye executive Kevin Mandia, allegedly taunting him with the inability of his company to attribute the attack to Russia. So far, that’s proven true. In a statement released in April of 2021, the White Houes formally named "the Russian Foreign Intelligence Service (SVR), also known as APT 29, Cozy Bear, and The Dukes, as the perpetrator of the broad-scope cyber espionage campaign that exploited the SolarWinds Orion platform." In the private sector, attribution has been more tentative because the tactics, techniques, and procedures (TTP) employed by the threat actor intentionally did not match known Russian attacker profiles as currently defined, including APT29 (Cozy Bear, Dukes). Instead, our colleagues attributed SolarWinds to a separate threat group, without associating it with Russia, and referred to it as UNC2452 (FireEye), Nobelium (Microsoft), StellarParticle (Crowdstrike), and Dark Halo (Volexity). Volexity is the only organization to publicly acknowledge and describe Dark Halo breaches that precede knowledge of the SolarWinds campaign. In a December 2020 blog, Volexity detailed a series of incident response engagements where Dark Halo gained access to an American think tank. In one of the breaches, Volexity noticed crossover with domains cited by FireEye as used in the second stage of SolarWinds. Volexity attempted to fingerprint those servers based upon unique features in the header of the HTTP server responses, only to find that whatever patterns Dark Halo may have established were quickly changed upon discovery. In so doing, they stumbled upon a key tactical countermeasure that significantly impeded analysis: the threat actor’s strict adherence to pattern avoidance. Atlas found that pattern avoidance was a tactic used across all aspects of this campaign. In Congressional testimony, Crowdstrike’s CEO said that the threat actor “leveraged unique Internet Protocol (IP) addresses for command and control infrastructure for each of its victims,” an action that makes correlating activity more difficult. RiskIQ's Team Atlas found that this infrastructure was registered under different names and at different times over several years to avoid establishing a traceable pattern. We assess that the domains were likely purchased from resellers or at auction and most were used previously by legitimate persons or businesses. Many of the historical records of their acquisition stopped with a third party. Many of the domains were “aged” (left inactive) for up to a year prior to being deployed. After use, the second and third-stage domains were decommissioned in small tranches, usually a few each month. The threat actor also gave thought to where the campaign infrastructure was hosted and avoided patterns there, too. RiskIQ's Team Atlas noted that the first-stage infrastructure was hosted entirely in the U.S., a move we assess was likely done to avoid raising suspicion (domestic network traffic is more plausible) as well as to avoid the prying eyes of the NSA, which is restricted by law to taking action only in foreign countries. The second-stage infrastructure was only partially hosted in the U.S. By the third-stage, the campaign’s infrastructure was hosted almost entirely in foreign countries. In this way, the threat actor avoided creating discernable patterns that could be traced while simultaneously making it harder for the U.S. government to investigate. The threat actor avoided patterns in its use of malware. The first-stage implant was designed to beacon to its command-and-control servers with random jitter after a two-week period, an effort RiskIQ's Team Atlas assessed was meant to outlive the typical lifespan of event logging on most host-based EDR products. In the second stage, a modified version of Cobalt Strike was used, which is significant because Cobalt Strike, a pentest tool, is available publicly. The third-stage malware was designed to look completely different from the second-stage malware which, in turn, was designed to look nothing like the first-stage malware. This ensured that analysts that found only one stage’s malware would likely have difficulty following it into the other stages. Taken together, the threat actor’s Tactics, Techniques, and Procedures (TTP) in this campaign were implemented in a way to avoid resemblance to prior patterns associated with APT29 or any of the other known Russian APT groups. Researchers or products which were attuned to detecting known APT29 or other Russian APT activity would therefore fail to recognize the campaign as it was happening. And they would have an equally hard time following the trail of Illuminating the Adversary’s Network Footprint: The Story Resumes The typical method of identifying a threat actor’s attack infrastructure footprint involves correlating IPs and domains with known campaigns and detecting patterns in domain registration, the aging of infrastructure before use, activity periods, etc. As discussed above, this threat actor made clear attempts to avoid creating such patterns. Despite their best efforts, the threat actors did not account for RiskIQ's unique network telemetry. When combined with the known indicators of compromise, this resulted in the successful fingerprinting of the command-and-control RiskIQ’s Team Atlas team began by reviewing all of the previously published indicators of compromise and noticed two patterns emerge through an analysis of the SSL certificates used: The majority of the SSL certificates used by the group were issued by Sectigo (Formerly Comodo CA). Additionally, they were all of a particular class called “PositiveSSL” which costs around $11 dollars a year per domain. The issue date of the certificates otherwise known as “Not Before” in x509 terminology was often more than a week prior to when the certificate itself was deployed in the wild. Or in several cases more than 40 days later. Searching for all SSL certificates issued by Sectigo Limited after February 1, 2020 matching the above criteria yielded ~ 334,053 results – too many to be useful. Next, RiskIQ's Team Atlas built upon Volexity's previous research in discerning patterns from HTTP banner responses from previously identified domains and IP addresses. We succeeded in identifying a number of patterns, as shown below. Note that any fields containing a value of “[Arbitrary]” were subject to change.We then combined the two data sets, correlating the domains and IPs that returned the specific banner response patterns with their relevant SSL certificates. We noted the corresponding periods of activity and hosting locations. This resulted in a more complete and context-rich view of the previously identified command-and-control infrastructure, After a little trial and error, RiskIQ's Team Atlas discovered a new pattern that could be leveraged across all the second stage, modified Cobalt Strike Beacon servers to identify additional infrastructure. While this pattern was not in and of itself unique (returning about 3,000 results on the internet at any given time), it became highly unique when correlated with the SSL patterns discussed above. The result was the identification of a significant number of additional malicious servers, RiskIQ's Team Atlas identified numerous other domains matching the original constraints, which included the server responses as well as SSL Certificate features. After further investigation we could not rule out the following domains from being associated with the actor; however, they typically served placeholding content and/or were hosted with previously unobserved providers. RiksIQ's Team Atlas is interested in learning more about this campaign and threat actor. We encourage analysts at security companies and/or organizations targeted in this campaign to contact us at atlas@riskiq.net. We've also included an old-fashioned spreadsheet, which helped us discern some of the interesting patterns such as coordinated termination dates for the various C2 servers.