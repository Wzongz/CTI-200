Since early 2014, an attacker group of Iranian origin has been actively targeting persons of interest by means of malware infection, supported by persistent spear phishing campaigns. This cyber-espionage group was dubbed ‘Rocket Kitten,’ and remains active as of this writing, with reported attacks as recent as October 2015. The Rocket Kitten group and its attacks have been analyzed on numerous occasions by several vendors and security professionals, resulting in various reports describing the group’s method of operation, tools and techniques. Characterized by relatively unsophisticated technical merit and extensive use of spear phishing, the group targeted individuals and organizations in the Middle East (including targets inside Iran itself), as well as across Europe and in the United States. Many of these targets were successfully compromised by various pieces of custom-written malware; and despite identification and flagging of their infrastructure, the attackers have struck again-and-again by making minor changes to their tools or phishing domains. Check Point has obtained a complete target listing from the attackers’ servers; among confirmed victims are high ranking defense officials, embassies of various target countries, notable Iran researchers, human rights activists, media and journalists, academic institutions and various scholars, including scientists in the fields of physics and nuclear sciences. It is our hope this report and measures taken over the past few weeks lead to an effective shutdown of attacker operations (current generation of tools and infrastructure). While Check Point customers are protected against all known variants of this threat, we urge fellow security vendors and malware research professionals to extend malicious IoC (Indicators-of-Compromise) coverage in current protection infrastructure. The Rocket Kitten campaign/actor group has been studied and analyzed on multiple occasions by different vendors, threat intelligence groups and individual researchers. In a repeating challenge in the malware research domain, we have seen different reports introduce a myriad of code names and operation names for what may very well be the same campaign/actors. In contrast to malware naming schemes, all reports are in unanimous agreement with strong indications of the campaign’s Iranian origin. This thesis is supported by the individuals and verticals targeted, as part of a plethora of circumstantial and direct evidence. While we should keep in mind digital evidence can be forged and tailored to falsely masquerade as any attacker to deceive a forensic analyst, the overwhelming amount of independent evidence collected over years of attack activity render the notion of a false campaign extremely improbable. Despite all the reporting and sharing of malicious indicators, Check Point has detected continued active attacks using the same methods and infrastructure. These findings were confirmed by other security vendors, as well as Check Point’s research partners. It seems as if the attackers, unsophisticated as they are, are completely undeterred by the western security industry’s revelations and publications. Often with the simple replacement of a domain name and minor updates to their malware tools, they continue to carry out their operation undisturbed. Let us try to review and briefly summarize points of interest from the publications so far.The May 2014 ‘Operation Saffron Rose’ publication identifies an Iranian hacking group formerly named ‘Ajax Security’ (code-named ‘Flying Kitten’ by CrowdStrike) engaged in active spear phishing attacks on Iranian dissidents (those attempting to circumvent government traffic monitoring). This group is potentially linked to more recent Rocket Kitten attacks (different tools, yet very similar mode of operation and phishing domain naming scheme). No concrete evidence of such link has been presented yet. Newscaster by iSight Partners was released the same month, to detail similar efforts of persistent spear phishing backed by false social media identities pertaining to be journalists of the fake news web site ‘newsonair.org.’ iSight, who reportedly cooperated with the FBI, provides a clear Iranian attribution to these efforts. The report specifies the attackers targeted policymakers, senior military personnel and defense industry organizations in the US, UK and Israel. We did not find direct evidence linking this activity to Rocket Kitten. ClearSky’s September 2014 blog post first described active attacks using a piece of malware they dubbed ‘Gholee’ (as appears in a malicious payload export function, potentially named after a popular Iranian singer9). The researcher points to initial leads into other attacks and notes the threat is currently undetected by the overwhelming majority of AV products. Gadi & Tillman’s presentation at 31c3 (the 31st Chaos Communication Congress in Germany) was the first clear identification of the Rocket Kitten attacker group, continuing the CrowdStrike naming scheme for Iranian attacker groups. The publication introduced the involvement of hacker persona ‘Wool3n.H4t’ and other identities in forensic evidence obtained from the malicious documents. Trend Micro’s March 2015 publication reintroduces the ‘Gholee’ malware (as GHOLE) campaign, and describes ‘Operation Woolen Goldfish,’ as well as an additional ‘CWoolger’—an unsophisticated key-logger apparently named ‘woolger’ (likely a Portmanteau for ‘wool3n keylogger’) written in C++, and present evidence showing its existence starting 2011. The researchers continue to point at the very likely attribution to the Wool3n.H4T identity as the malware author, whose only online reference was found in an Iranian blogging platform. In this publication, Trend Micro researchers document Rocket Kitten’s minor update to the Gholee malware (the ‘gholee’ function was renamed to ‘function’), supposedly to avoid the Yara signature published by ClearSky and document the existence of Gholee malware samples dating March 2011, as further evidence for historic attacker activity. ClearSky continued their investigations into the group’s activities and in June 2015 published a paper dubbing the attack campaign ‘Thamar Reservoir’ named after Dr. Thamar E. Gindin, herself a Rocket Kitten target. ClearSky researchers notably mention the breach of an Israeli academic institution to serve as a hosting service for the phishing web site, and follow to present an OPSEC (operational security) failure by the attackers that allowed ClearSky to learn of a detailed (partial) target list. This list was analyzed to confirm a strong alignment with nation-state political interests, with specific victims known as adversarial or of intelligence value to Iran. ClearSky also reference an inadvertent public confirmation for the Iranian attribution by the US Department of Treasury in a memo which briefly appeared online, before being deleted. ClearSky provided many examples of personalized phishing e-mails and communication, including phone calls to victims luring them to open these attachments, demonstrating the group’s persistency and breadth of operations.The same phishing phone calling scheme was detailed in an August 2015 report by Citizen Lab, describing attempts to lure victims to provide their two-factor authentication tokens. In these attempts, victims receive tailored calls from a person who has clearly researched them, prompting them to take action on received e-mails. Among targeted victims Citizen Lab mention EFF’s Director for International Freedom of Speech Jillian York. The Citizen Lab report describes overlapping phishing domains with ones previously reported, confirming a link with Rocket Kitten. Interestingly, a special update to the Citizen Lab publication was added to include a response from a news outlet reported to be in close connection with Iranian intelligence, following allegations by exiled Iranian journalist Omid Memarian attributing these attacks to Iranian Revolutionary Guards10 with ‘no doubt.’ The response mocks the ‘Western Media fishing in muddy waters’ and describe the allegations as ‘weird.’ The latest paper from Trend Micro and ClearSky (dated September 2015) goes a great length to detail the group’s profile and mode of operations so far, and introduces a few more attack incidents, as well as a new ‘downloader’ piece of malware.The Rocket Kitten attacker group’s main attack vector is spear-phishing. An effective phishing campaign requires nothing more than a tailored phishing page, hosted on a cheaply-available web server. As described in previous publications, the Rocket Kitten attackers make extensive use of various phishing schemes, often including back-and-forth e-mail correspondence with the victims, or even phone calls to establish legitimacy and reason to open the malicious attachment. Actual malicious attachments detected in this campaign varied between a set of custom-written malware pieces, or ‘downloader’ components that, in turn, fetch the malware from a remote server and execute in on the victim machine. Additionally, we have witnessed many attacks using various ‘web hacking’ tools and suites, in attempt to break into victim web sites. Previously reported custom-malware included: In addition to custom-written malware, we have seen the attackers use various hacking and scanning tools to attack victim web-sites. Web hacking attempts were detected to originate from various IP ranges, occasionally immediately adjacent to known Rocket Kitten C&C servers. We can estimate the attack operators either used these servers directly, or configured them as Proxy/VPN endpoints to channel their attacks. Combining the research work done so far with observed attacks by Check Point, we can map out a diagram overviewing the attacker’s infrastructure. After learning of an active attack incident from the Rocket Kitten group on a customer network, Check Point researchers decided to actively join the investigation. While the recent paper from Trend Micro and ClearSky (‘The Spy Kittens Are Back: Rocket Kitten 2’) does extensively cover the campaign’s narrative, we aimed to seek confirmation that our analyzed attack was positively connected to the same campaign and set out to provide additional value and insight. Upon learning of the attack, we attempted to communicate with the phishing web server and gather primary reconnaissance. We learned the same IP address was used for multiple malicious domains. Noting the server on this IP address was alive and well, we decided to probe and question that particular server’s purpose. What we found took us all by surprise. We started our web probe by making scripted GET requests attempting to browse to well-known paths. A minute later, we were excited to find a 200 OK response for a few requests, including /xampp and none other than /phpmyadmin(!). Suspecting false positive results by our scripts, we typed in /xampp into our browser and watched with awe: We curiously entered the direct path into our web browser and loaded the phpmyadmin interface. It wasn’t until we actually submitted a query on the server, when we understood that phpmyadmin had been configured to allow password-less root access to any browsing visitor. “Such a gaping hole must be a decoy” we immediately thought. There is no way nation-state attackers would err in such amateur fashion, leaving their phishing server database exposed… would they?If only they had paid attention to the ‘XAMPP Security’ page: Happily browsing through the free-for-all exposed database, we quickly noted numerous schemas; most of them were completely empty (for testing purposes?), with one specific schema standing out: ‘phakeddb’. ’phakeddb’ contained a set of very interesting tables and data sets; the kind of data sets that fuel the fantasies of malware campaign researchers. Browsing these tables, we found the phishing web application, likely to be a custom development by the Rocket Kitten attackers. The web application would, upon operator instruction, generate the target-specific personalized phishing page for the targeted service (Gmail, YouTube, Hotmail, etc…). As we later learn, this platform was named ‘Oyun Management System’ by the attackers. The attackers log in to the application, just like any other web platform, in order to set up their phishing campaigns. This server seems to have been deployed August 2014, when all users were created. And the hash type of passwd fields used? You may not be surprised to learn they used unsalted MD5 hashes. That’s actually not the most oblivious malpractice in this system, however; the hash for the user named “super admin” (assigned with all possible permissions) is e10adc3949ba59abbe56e057f20f883e. Hobbyist cryptographers may recognize this string as the MD5 hash for “123456”. Looking at user names, we can spot some potentially Persian names or aliases such as merah, kaveh, ahzab or amirhosein. These were potentially the campaign ‘operators’—tasked with social engineering and tailoring a phishing page per target. (hint: “123456” was not the only trivially crackable password in this list) Moving on to the intriguing “conversation” table, this appears to be an experimental messaging feature between attackers. Unfortunately, it was rarely used.Most messages include links to various phishing domain pages, perfectly correlating to reported attack pages, proving this database is indeed in direct correlation to the attacks. Interestingly enough, we can see user id 55 (correlating with the ‘attache’ username in the users table) making a request. We can see template codes for phishing pages, including the descriptive “Victim Full Name,” “Victim User Name” field values. It seems that this application generates the custom phishing templates using these custom fields. Even more telling, we have examples for each field, reintroducing us to our Wool3n.H4T friend (author of key-logger malware by the same group), repeatedly mentioned in this column. This introduces the reasonable possibility that Wool3n.H4T himself wrote this “phishing application” as a supporting tool for the campaign. There is an intriguing ‘supervisor@ybsoft.com’ reference, too, but ybsoft.com is currently registered to a Chinese electronics shop, so no luck in that direction. The real jackpot, however, is still ahead. When we opened the ‘projects’ table, we momentarily lost our breath. A ‘project’ is apparently a single victim (target e-mail address), assigned with a ‘proj_id’, a tasked operator, and the specific link that was generated to be sent to this victim. We just hit 1842 records including all victims attacked starting August 2014 and all the way to August 2015 (when this database was accessed). Not only do we have the e-mail addresses of all victims, we also have the template values for their respective phishing pages (in the ‘projectmailrequirevalues’ table)!. For example a ‘Google Sign-In’ page normally displays the full name of the victim, as well as a public avatar defined by the user. The attackers had to replicate this look and feel, and filled the database with full names, addresses and photos for every targeted victim. We verified and retrieved names and images of previously reported victims as expected. This table contained a log entry for every access to any phishing page, including the credentials provided by the victims, if successfully fooled. We can now use this data to gather insightful analytics on spear phishing activity over one year spanning August 2014 to August 2015. Please see the attack log analysis section in this report. Continuing our server probe, we discovered a similarly exposed ‘Webalizer’ interface, providing useful analytics including counters and frequently accessed links. The Webalizer interface neatly presented us with a lot of useful metadata, including “Top 40 visitor IPs”—clearly identifying attacker access to the site, and providing us with many leads for the remainder of the investigation. Interestingly enough, we also found some referrer headers, leading to a path on the same server:In what can be described as a ‘hacker secret access’ portal—we seem to have reached the web interface of the phishing platform. Testing the ‘admin’ credentials we previously “cracked”—we get: We now learn the attackers name this system “Oyun” and actually used Larry Page’s public profile picture as admin’s avatar. The remainder of the interface simply allows access to the phakeddb database, including insertion, editing of “projects” (/targets) and even the internal chat platform as evident in “conversations.” Using credentials hard-coded into the woolen key-logger, we were able to retrieve numerous woolger DAT files (key-logs), as uploaded from victims around the world. As apparent, the same hard-coded FTP credentials were, in fact, Administrator credentials on the C&C Windows server itself, which had the C$ and D$ NetBIOS/SMB administrative shares openly accessible from the WAN.Among many logged keystroke files containing stolen data, we stumbled on an astonishing discovery: the Rocket Kitten attackers had, in fact, infected their own workstations, apparently as ‘test-runs’ for woolger. The attackers failed to remove these files from the C&C server, demonstrating, yet again, utter lack of OPSEC. Of peculiar interest to us were logs made by none other than ‘Wool3n.H4t’ himself: Yes, we actually just witnessed Wool3n.H4T switching through his open windows, including a Microsoft Visual Studio live debugging session of a project called… ‘CWoolger’ In another log, we observe the specific programming of loading of the ‘wsc.vbs’ script, as observed in the Trend Micro publication and others. At this point, there should be no question—we are looking at the malware author’s development workstation.The next log shows us the attacker wanted to test whether his tool would accurately capture credentials entered into a Firefox HTTP authentication prompt, and thus he entered his own C&C server…Recorded under the Wool3n.H4T name, a user logs into AOL mail with username ‘yaserbalaghi.’ Could it be the same ‘Yaser’ as noted in the recent Trend Micro and ClearSky paper? (‘D:\Yaser Logers\CWoolger’…) Could it explain the Phakeddb reference to “ybsoft”? We don’t know at this point; we have to go deeper. ‘yaserbalaghi@aol.com’ appears to give a technical answer in a long C++ thread in an Iranian programmers forum (“Barname Nevis”) in Iranian ‘Solar Hijri’ calendar year 1389 (2010-2011): The same yaserbalaghi user made several posts, also linking to various programming instructional videos in the subjects of ASP.NET and AJAX, jQuery and SQL injections as instructed by him using screen capture software. Careful watching of the videos allowed us to learn a few interesting details. For starters, Yaser Balaghi is a Microsoft Visual Studio 2010 user, with familiarity of several tools observed to be used during the ‘Rocket Kitten’ campaign. Further inspecting the user names and host names evident in the screen captures, we noticed we were actually in possession of logged keystrokes from an "infected computer” where the user name was “Engineer Balaghi,” strengthening our suspicions. However, we can’t be sure yet; Yaser Balaghi may be a common name or perhaps this is someone related to Wool3n.H4T or the attackers. A few minutes later, and we spotted this gem of an OPSEC mistake in the SQLi instructional video, which precisely provided the smoking gun we were after:Wool3n.H4t is caught red-handed. One of his many mistakes, he was now caught giving a public tutorial while logged in under his secret alias, otherwise unlinked with his real identity. These videos were recorded February 2014, prior to the first clear Rocket Kitten attack wave mid-year. A quick glance on W00l3n.Hat’s desktop reveals a striking match with web hacking attack tools previously described in Rocket Kitten’s arsenal. A few online queries later, we are getting numerous results, cross-referenced to verify as the same Yaser Balaghi, now the main suspect to hold the Wool3n.H4T identity. Engineer Yaser Balaghi is not only an active member of various programming forums—he had a web site (www.eng-balaghi.com, gone offline since August 2014, still available in the Wayback Machine). In the available archived version of the site he described himself as a “programmer, analyst, consultant and lecturer,” and made himself available for hire.Islamic Azad University Computer Software Graduate Balaghi lists his job experience, including “Technical Director and Team Leader of Software Development Team (Private)” (highlighted in original), as well as “Head of Security and Hacking (legal and ethical) (Private)”. Later, he goes as far as listing sample accomplishments and completed projects, including the development and system design for a “Phishing Attacks System” ordered by “a cyber-organization” We could go on, but the main lesson of this section can be: if you don’t want people to know you created malware for the government, don’t list it in your CV. As reported so far, the attackers persistently e-mailed, called and responded with fake identities, tailored for each victim. The attackers clearly read the public reports about them, respond and adapt their tactics, occasionally showing a creative mindset. In one reported case, the attacked posed under the true identity of a ClearSky researcher, referencing the recent Rocket Kitten report, attaching “detection software” that does exactly the opposite. This an interesting tactic, worthy of mentioning in social engineering classes. It would be wise at this point to mention that the release of report does not include any accompanying detection or protection tools other than the existing Check Point software blades. If you received this report with an attached executable, it is likely a malicious lure. In another case, the attackers sent a malicious attachment using the identity of a previously known targeted victim. The Israeli recipient of that attachment was wary enough to suspect the origin of the e-mail and responded with a query: “Is that you or are the Iranians in your computer again?” To which the attackers responded (in perfect non-Google-Translate Hebrew): “The Iranians will never return to my computer!” That very well may have been the talk of the day at the Tehran operations center, possibly featured in an email printout in the main dining room. As the Rocket Kitten group’s behavior was well characterized in previous publications (see the recent report from Trend Micro and ClearSky). We will focus on new insights based on our analysis of the ‘Oyun’ system victim database. We understand that this database contains a partial view, starting August 2014 to August 2015. While the data can be successfully correlated with logs collected from other servers, we have no visibility of e-mails with malicious attachments (as opposed to phishing links to steal credentials), or any complete web hacking log for attacker activity. The sheer volume of the target database suggests an extensive operation, the work of a group of people over months. The logs included the visiting IP address geo-located country. Our analysis shows the following distribution: We have studied the visitor data to determine this includes many attacker accesses to test the site functionality. We know the attackers used addresses from Iran, as well as VPN access from the US, Germany, Saudi Arabia and the Netherlands. The data must be interpreted taking these facts into consideration.Our primary filtering dismissed around 25% of logs and 15% of projects as ‘test runs’ for the system. The following is based on the remaining seemingly valid entries. Charting the phishing logs over time, we can observe the following timeline:We believe the Rocket Kitten case is an interesting case study for the malware research industry, exemplifying a continuing trend in the nation-state attacker profile we have witnessed over the past two years; cyber-espionage is no-longer reserved to organizations with monstrous budgets to hire thousands of cyber-warriors, operate password-cracking super-computer clusters or advanced research to infect your hard-drive firmware. Adversaries will often find simpler ways for effective compromise, such as creative phishing and simple custom malware. In this case, as in other previously reported cases, it can be assumed that an official body recruited local hackers and diverted them from defacing web sites to targeted espionage at the service of their country. As is often the case with such inexperienced personnel, their limited training reflects in lack of operational security awareness, leaving a myriad of traces to the origin of the attack and their true identities (e.g. Yaser Balaghi, Mehdi Mahdavi and others). Despite publications, code names and articles in security outlets - the same known attacker group continues to attack with minimal interruption. Highlighting a repeating industry problem, minimal changes to existing malware often evade most current protection solutions. Effectively stopping attackers must involve action on top of analysis efforts. We approached and will continue to approach hosting providers through the assistance of CERT coordination and other bodies in various countries. We hope these efforts are fruitful, and can help disable or reduce the attacking infrastructure. This malware is basically a RAT (Remote Access Trojan). It implements such functionality as a key-logger, sniffing TCP and UDP traffic, taking screenshots, as well as a remote command shell. Also, it may gather a lot of information about the target system such as enumeration of files, drives, services, process information and the ability to send any file to the C&C server.