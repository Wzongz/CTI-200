After our investigation of APT SideWinder, we’ve done a yara rule for hunting RTF document exploiting the CVE-2017–11882. We found a document written in Vietnamese dealing with a summary about differents projects in the district Hải Châu of Đà Nẵng.In this article, we’ll detail the infection chains and the infrastructures of the attackers and the TTPs of this campaign. The infrastructures and TTPs during this campaign seem to the Chinese hacking group 1937CN.Joe sandbox has a good representation of the behaviour of the infection.This rtf document is really malicious and it exploits the equation vulnerability to write two files in the system: At the start of the analysis, we think the process EQNEDT32.exe is created by Winword.exe using the function CreateProcess. So we decided to set a breakpoint at the call of his function. But EQNEDT32.exe is invoked by Winword.exe using COM Object. It’s not CreateProcess that used and Winword.exe is not the parent process of EQNEDT32.exe. So we have to attach the debugger when EQNEDT32.exe is launched. For that, we used a technique named Image File Execution Options that was documented by Microsoft. https://blogs.msdn.microsoft.com/mithuns/2010/03/24/image-file-executionoptions-ifeo/ We create a key EQNEDT32.exe. Registry HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options And we set a value string for launching the debugger when EQNEDT32.exe is executed and attaching the debugger to the process .And the shellcode decrypts the 8.t file in memory at 0066C82A. The loop of decryption is a xoring with different manipulations on the decryption key. At the start of the decryption the key is set to 7BF48E63. Set the decryption key in EAX If we check the destination of the result of the xoring (here edx + ebx), we find 01FD0000 where 8.t is loaded. After two step of the loop, we can see the magic number MZ set at the begin of memory section. the PE decrypted is copied in the new memory page After GetModuleFileNameA is called to have the path of EQNEDT32.exe And EQNEDT32.exe is forked in suspend status by a CreateProcess and the shellcode overwrite it by the PE at the address 02070000 Stack used by NTWriteVirtualMemory And the shellcode does a ResumeThread to launch the new PE. So, We’ve found all API Calls in the object ole at the beginning and we have a runPE to launch the new EQNEDT32.exe overwritten.If we check the call graph, DropFiles is called only by the function sub_4012D0. Functions using DropFiles function So we set a breakpoint on CreateFile because at each execution, EQNEDT32.exe starts by CreateFile onstaticcache.dat.And after the file is created with the following path: L”C:\\Users\\IEUser\\AppData\\Roaming\\Microsoft\\Windows\\Network Shortcuts\\RasTls.dll” Stored by ebx. DropFiles is called a twice to decrypt and decompress the executable file. The offset where store the file is 00434EF8 and the pe decompressed is stored at 025D0020Expansion of domains There are two domains really interesting: Halong.dulichculao.com is already used in the campaign targeting Vietnameses organizations.The Chinese hacking group 1937CN continues to target Vietnam officials with the same TTPs with a refreshing on the tools used. The toolset used by this group to create RTF malicious document has the same properpy of the SideWinder. I want to thank my buddies on “Zone de Confort”. It’s with this dreamteam, I can finalize correctly this analyses. In the second part, we analyze the RAT using in this campaign. Or if another reverse can make that, I’ll paid a beer ;)