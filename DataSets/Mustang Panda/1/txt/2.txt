From early May 2020, The Vatican and the Catholic Diocese of Hong Kong were among several Catholic Church-related organizations that were targeted by RedDelta, a Chinese-state sponsored threat activity group tracked by Insikt Group. This series of suspected network intrusions also targeted the Hong Kong Study Mission to China and the Pontifical Institute for Foreign Missions (PIME), Italy. These organizations have not been publicly reported as targets of Chinese threat activity groups prior to this campaign. These network intrusions occured ahead of the anticipated September 2020 renewal of the landmark 2018 China-Vatican provisional agreement, a deal which reportedly resulted in the Chinese Communist Party (CCP) gaining more control and oversight over the country’s historically persecuted “underground” Catholic community. In addition to the Holy See itself, another likely target of the campaign includes the current head of the Hong Kong Study Mission to China, whose predecessor was considered to have played a vital role in the 2018 agreement. The suspected intrusion into the Vatican would offer RedDelta insight into the negotiating position of the Holy See ahead of the deal’s September 2020 renewal. The targeting of the Hong Kong Study Mission and its Catholic Diocese could also provide a valuable intelligence source for both monitoring the diocese’s relations with the Vatican and its position on Hong Kong’s pro-democracy movement amidst widespread protests and the recent sweeping Hong Kong national security law.While there is considerable overlap between the observed TTPs of RedDelta and the threat activity group publicly referred to as Mustang Panda (also known as BRONZE PRESIDENT and HoneyMyte), there are a few notable distinctions which lead us to designate this activity as RedDelta: The version of PlugX used by RedDelta in this campaign uses a different C2 traffic encryption method and has a different configuration encryption mechanism than traditional PlugX. The malware infection chain employed in this campaign has not been publicly reported as used by Mustang Panda. In addition to the targeting of entities related to the Catholic Church, Insikt Group also identified RedDelta targeting law enforcement and government entities in India and a government organization in Indonesia.For many years, Chinese state-sponsored groups have targeted religious minorities within the the PRC, particularly those within the so-called “Five Poisons,” such as Tibetan, Falun Gong, and Uighur muslim communities. Insikt Group has publicly reported on aspects of this activity, such as our findings on RedAlpha, the ext4 backdoor, and Scanbox watering hole campaigns targeting the Central Tibetan Administration, other Tibetan entities, and the Turkistan Islamic Party. Most recently, a July 2020 U.S. indictment identified the targeting of emails belonging to Chinese Christian religious figures — a Xi’an-based pastor, as well as an underground church pastor in Chengdu, the latter of whom was later arrested by the PRC government, by two contractors allegedly operating on behalf of the Chinese Ministry of State Security (MSS). Regional branches of China’s Ministry of Public Security (MPS) have also been heavily involved in digital surveillance of ethnic and religious minorities within the PRC, most notably by the Xinjiang Public Security Bureau (XPSB) in the case of Uighur muslims. Historically, the PRC has had a highly turbulent relationship with the Vatican and its governing body, the Holy See. In particular, the Holy See’s recognition of bishops within China’s historically persecuted “underground” Catholic church traditionally loyal to the Vatican and its relationship with Taiwan has maintained an absence of official relations since the 1950s. The CCP perceived this behavior as the Holy See interfering in religious matters within China. In September 2018, the PRC and the Holy See reached a landmark two-year provisional agreement, marking a significant step towards renewed diplomatic relations. Under the provisional agreement, China would regain more control over underground churches, and the Vatican in turn would gain increased influence over the appointment of bishops within the state-backed “official” Catholic church. The deal was met with a mixed reaction, with critics arguing that the deal was a betrayal of the underground church and would lead to increased persecution of its members. Many of the harshest criticisms came from clergy within Hong Kong. A year after the agreement, numerous reports noted the Vatican’s silence in response to the Hong Kong protests beginning in late 2019, in what critics called an effort to avoid offending Beijing and jeopardizing the 2018 agreement.Using Recorded Future RAT controller detections and network traffic analysis techniques, Insikt Group identified multiple PlugX C2 servers communicating with Vatican hosts from mid-May until at least July 21, 2020. Concurrently, we identified Poison Ivy and Cobalt Strike Beacon C2 infrastructure also communicating with Vatican hosts, a Vatican-themed phishing lure delivering PlugX, and the targeting of other entities associated with the Catholic Church.The lure document shown above, which has been previously reported on in relation to links to Hong Kong Catholic Church targeting, was used to deliver a customized PlugX payload that communicated with the C2 domain systeminfor[.] com. The document purported to be an official Vatican letter addressed to the current head of the Hong Kong Study Mission to China. It is currently unclear whether the actors created the document themselves, or whether it is a legitimate document they were able to obtain and weaponize. Given that the letter was directly addressed to this individual, it is likely that he was the target of a spearphishing attempt. Additionally, as this sample was compiled after signs of an intrusion within the Vatican network, it is also possible that the phishing lure was sent through a compromised Vatican account. This hypothesis is supported by the identification of communications between PlugX C2s and a Vatican mail server in the days surrounding the sample’s compilation date and its first submission to public malware repositories.The head of the Hong Kong Study Mission is considered the Pope’s de facto representative to China and a key link between Beijing and the Vatican. The predecessor to this role played a key part in the finalization of the 2018 provisional China-Vatican agreement, making his successor a valuable target for intelligence gathering ahead of the deal’s expiry and likely renewal in September 2020. Further entities associated with the Catholic Church were also targeted by RedDelta in June and July 2020 using PlugX, including the mail servers of an international missionary center based in Italy and the Catholic Diocese of Hong Kong. Insikt Group identified two additional phishing lures loading the same customized PlugX variant, which both communicated with the same C2 infrastructure as the Vatican lure. The first sample included a lure document spoofing a news bulletin from the Union of Catholic Asian News regarding the impending introduction of the new Hong Kong national security law. The content of the lure file, titled “About China’s plan for Hong Kong security law.doc,” was taken from a legitimate Union of Catholic Asian News article. The other sample also references the Vatican using a document titled “QUM, IL VATICANO DELL’ISLAM. doc” for the decoy document. This particular decoy document translates as “Qum, the Vatican of Islam,” referring to the Iranian city of Qum (Qom), an important Shi’ite political and religious center. It is taken from the writings of Franco Ometto, a Italian Catholic academic living in Iran. Although the direct target of these two lures are unclear, both relate to the Catholic church. We believe that this targeting is indicative of both China’s objective in consolidating increased control over the underground Catholic Church within China, and diminishing the perceived influence of the Vatican on Chinese Catholics. Similarly, a focus on Hong Kong Catholics amid pro-democracy protests and the recent sweeping national security law is in line with Chinese strategic interests, particularly given the Anti-Beijing stance of many of its members, including former Hong Kong Bishop Cardinal Joseph Zen Ze-kiun.Insikt Group identified several additional suspected victims communicating with RedDelta C2 infrastructure. While metadata alone does not confirm a compromise, the high volume and repeated communications from hosts within targeted organizations to these C2s are sufficient to indicate a suspected intrusion. A full list of identified targeted organizations are summarized below:The organizations targeted by RedDelta in this campaign largely align with historical activity publicly reported on the threat activity group Mustang Panda, with the group previously linked to intrusion attempts targeting the Police of the Sindh Province in Pakistan, law enforcement organizations in India, and the targeting of entities within Myanmar, Hong Kong, and Ethiopia. The group is also suspected to have previously targeted China Center (China Zentrum e.V), a non-profit organization whose members includes Catholic aid organizations, religious orders and dioceses in Germany, Austria, Switzerland, and Italy, and other organizations associated with religious and minority groups. In this campaign, RedDelta favored three primary IP hosting providers, and used multiple C2 servers within the same /24 CIDR ranges across intrusions. Preferred hosting providers included 2EZ Network Inc (Canada), Hong Kong Wen Jing Network Limited, and Hong Kong Ai Jia Su Network Limited. The group consistently registered domains through GoDaddy, with WHOIS data providing additional linkages between domains used by the threat activity group. Insikt Group identified two primary clusters of RedDelta infrastructure used throughout this campaign, referred to as the “PlugX cluster” and the “Poison Ivy and Cobalt Strike cluster.” A Maltego chart is included below displaying these clusters.Vatican hosts and several other victim organizations were communicating with the PlugX C2 167.88.180[.]5 from May until June 10, 2020. This IP hosted the domain cabsecnow[.]com over this time period. Cabsecnow[.]com then resolved to a new IP, 103.85.24[.]136, from June 10 onwards. The suspicious network activity continued after the C2 IP was updated, increasing our confidence in the likelihood of intrusion at the targeted organizations. The cabsecnow[.]com domain shares a similar naming convention to a publicly reported domain linked to Mustang Panda, cab-sec[.]com. WHOIS data revealed that both domains were registered several seconds apart through GoDaddy on September 17, 2019, with the same registrant organization listed: “Ma Ge Bei Luo Xiang Gang Jiu Dian.” This registrant organization is associated with eight domains in total, five of which have previously been publicly linked to Mustang Panda activity by Anomali and Dell SecureWorks. “Ma Ge Bei Luo Xiang Gang Jiu Dian” translates from Mandarin to Marco Polo Hotel Hong Kong, a legitimate Hong Kong hotel, although it is unclear why the actor chose this organization when registering these domains.Another PlugX C2, 85.209.43[.]21, was also identified communicating with several hosts within the same targeted organizations (see Table 1). This IP has hosted ipsoftwarelabs[.]com since November 2019, a domain previously identified as a Mustang Panda PlugX C2. Finally, the C2 domain associated with the Vatican and Union of Catholic Asian News lures, systeminfor[.]com, was hosted on 167.88.180[.]32 since June 2020. This IP has also hosted lameers[.]com since February 2020, another PlugX C2 identified in activity targeting Hong Kong.The second cluster featured Cobalt Strike and Poison Ivy malware C2 infrastructure. A Poison Ivy sample (SHA256:9bac74c592a 36ee249d6e0b086bfab395a37537ec87c2095f999c00b946ae81d) submitted to a public malware repository from Italy in early June 2020, several days after the first evidence of activity between Vatican hosts and this C2, was configured to communicate with a spoofed Microsoft domain, web.miscrosaft[.]com, hosted on 154.213.21[.]207. Suspicious network traffic between this Poison Ivy C2 and several Vatican hosts, as well as an Indian aviation entity, were observed by Insikt Group analysts. Two other IP addresses within the same 24-bit CIDR range, 154.213.21[.]73 and 154.213.21[.]70, were also identified communicating with overlapping Vatican infrastructure at this time. A Cobalt Strike sample (SHA256: 7824eb5f173c43574593bd3afab41a60e0e2ffae80201a9b884721b451e6d935), uploaded from an Italian IP address to a malware multiscanner repository as a zipped file the same day as the Poison Ivy sample, also used the 154.213.21[.]70 IP for command and control. This cluster of activity does not overlap with the infrastructure identified in the PlugX cluster. The WHOIS registration data for the domains miscrosaft[.] com and hostareas[.]com contains the registrant organization “sec.” While less distinct than the “Ma Ge Bei Luo Xiang Gang Jiu Dian’’ registrant identified earlier in the PlugX cluster, there are still relatively few domains associated with this organization, and fewer still that were registered through GoDaddy. Using these characteristics, we identified that the domains svrhosts[.]com, strust[.]club, and svchosts[.]com all match this criteria and are previously reported Mustang Panda Cobalt Strike C2 domains. In particular, svrhosts[.]com and svchosts[.]com were both registered at the same time as hostareas[.]com on February 3, 2019 through GoDaddy.While there is notable targeting and infrastructure overlap between this RedDelta campaign and publicly reported Mustang Panda activity, there are some deviations in tactics, techniques, and procedures (TTPs) used in both. For instance, Mustang Panda has typically used Windows Shortcut (LNK) files containing an embedded HTA (HTML Application) file with a VBScript or PowerShell script to load PlugX and Cobalt Strike Beacon payloads. However, in this campaign, RedDelta used ZIP files containing legitimate executables masquerading as lure documents, a notable departure from Mustang Panda activity that has been publicly reported previously. This legitimate executable is used to load a malicious DLL also present within the ZIP file through DLL sideloading, before the target is shown a decoy document. While Mustang Panda have used DLL sideloading previously, the PlugX variant used in association with this campaign has key differences from more traditional PlugX variants, particularly in the C2 protocol used and the configuration encoding within the samples, leading us to refer to it as the “RedDelta PlugX” variant below — however, this is not intended to suggest that this variant is used exclusively by this group and is in reference to the first group we have seen using this variant.The first sample, titled “About China’s plan for Hong Kong security law.zip” (SHA256:86590f80b4e1608d0367a7943468304f7eb665c9195 c24996281b1a958bc1512), corresponds to the Union of Catholic Asian News lure delivering the RedDelta PlugX variant. Although Insikt Group does not have full visibility into this infection chain, the ZIP file is likely to have been delivered via a spearphishing email. The ZIP contains two files:“About China’s plan for Hong Kong security law.exe” is a legitimate Windows loader for Microsoft Word that is vulnerable to sideloading. When executed, it sideloads the malicious DLL, “wwlib.dll.” Wwlib.dll initializes the loading stage by downloading, decoding, and executing an XOR-encoded Windows executable file, hk.dat, from http://167.88.180[.]198/ hk.dat. Next, wwlib.dll will extract a Word document, “About China’s plan for Hong Kong security law.docx” from its resource section and open it to make it appear to the user that a legitimate Microsoft Word document was opened.Next, “hk.exe” is executed and creates copies of the files “adobeupdate.dat,” “hex.dll,” and itself renamed as “AAM Updates.exe” in the folder “C:\ProgramData\ AAM UpdatesIIw.” “AAM Updates.exe” is then executed, starting the installation process by sideloading the malicious “hex.dll.” “Hex.dll” will decode and execute “adobeupdate.dat,” which ultimately leads to the execution of the RedDelta PlugX variant in memory. This use of DLL sideloading, including the use of this specific Adobe executable, aligns with recent public reporting of Mustang Panda PlugX use.The second PlugX sample uses the same loading method identified above. In this case, the same WINWORD.exe executable is used to load another malicious wwlib.dll file. The sample then contacts http://103.85.24[.]190/qum.dat to retrieve the XOR-encoded Windows executable file, qum.dat. This sample uses the same C2 as above, www.systeminfor[.]com.The final PlugX sample featuring the Vatican Hong Kong Study Mission lure also uses largely the same PlugX loading method. In this case, the ZIP file contains a benign Adobe Reader executable, AcroRd32.exe, renamed “DOC2020-05-15T092742.441.exe,” which is used to load the malicious acrord32.dll file through DLL sideloading. In this case the sample retrieves the file dis.dat from http://167.88.180[.]198/dis.dat and uses the same C2 referenced in the previous samples.Insikt Group performed detailed analysis on the DAT files related to the “Union of Catholic Asian News” and “Qum, the Vatican of Islam” lure. Analysis of these samples showed two DAT files were downloaded from the URLs listed in the table below:In each case, the file (“hk.dat” or “qum.dat“) is downloaded and executed after initial execution of the phishing lure, as described above in “Stage 1: Wwlib.dll DLL Sideload and Hk.dat Download and Execution.” Both files are RtlCompress/LZNT1 compressed, as well as XOR-encoded. The XOR key precedes the encoded data, allowing the file to be more easily decoded during static analysis. A Python script to decompress and decode the payload can be found on our GitHub repository. After the DAT files are decompressed and decoded, they are executed. The execution details for “hk.dat” have been detailed above (see: “Stage 2: Hk.exe/AAM Updates.exe DLL Sideloading to Load PlugX Variant“) and are nearly identical to that of “qum.dat.” As with the hk.dat sample associated with the “Union of Catholic Asian News” lure, the main purpose of this stage of the malware is to perform the DLL sideloading step in order to execute the PlugX variant. Again, the final stage consists of three files: a non-malicious executable, a malicious sideloaded DLL, and the encoded DAT file which are all used to sideload the final payload. This is consistent with a typical PlugX installation. Like the first-stage DAT files, the PlugX loaderDAT file is XOR-encoded and the decode key precedes the encoded data in the file; however, they are not RtlCompress/LZNT1 compressed as the initial stage files are. A Python script to decode the PlugX loader, as well as the configuration block, is contained on our GitHub repository.The PlugX variant used in the RedDelta campaign is similar to the PlugX variants previously associated with Mustang Panda by Avira and Anomali. Both make heavy use of stack strings as an obfuscation mechanism, as seen in Figure 8, making it harder for an analyst to use strings to determine the functionality or purpose of the code.However, the configuration block for the RedDelta PlugX variant has one key distinction: the Avira-reported Mustang Panda configuration block decoding function looks for the string “XXXXXXXX” to determine whether the configuration is encoded, while the RedDelta variant looks for the string “########.” Apart from the different demarcator strings, both variants use the same rolling XOR encoding with the key “123456789.” The configuration block decode routine can be seen in Figure 9, below.In conventional PlugX samples, the configuration block is encrypted with a more complex algorithm using multiple keys in combination with shift left and shift right bitwise operations. For example, the Python code implementing this algorithm, as seen in Figure 11, was created by Kyle Creyts based on Takahiro Haruyama’s extensive research and analysis on PlugX. The configuration block encryption associated with the RedDelta variant is considerably less sophisticated when compared to traditional PlugX samples, and while both make use of XOR-based ciphers, the simple algorithm used by RedDelta would be easier to brute force by an analyst.The C2 protocol used for the RedDelta PlugX malware differs from the Mustang Panda PlugX. While both variants use the HTTP POST method common to PlugX including the number of “61456” in the POST header field which is a clear indicator of a PlugX HTTP POST. However, the RedDelta variant does not include the URI string “/update?wd=” more commonly associated with PlugX, as seen in Figure 12.The RedDelta PlugX variant encrypts its C2 communications very differently when compared to the Mustang Panda variant reported by Anomali and Avira. Instead of using XOR encoding, RedDelta uses RC4 encryption where the first 10 bytes of the passcode are hardcoded and the last four bytes are randomly generated and included as a key within the TCP packet so that the communication can be decrypted. The hardcoded portion of the RC4 passphrase is “!n&U*O%Pb$.” Figure 13 shows the function where the RC4 passphrase is defined as well as where the last four bytes are appended to create the full key. A Python script to decode the RedDelta C2 communication from a supplied PCAP can be found on our GitHub repository. Despite the different C2 encryption schemes, both RedDelta and Mustang Panda variants’ C2 traffic decrypts to the familiar PlugX header format, as shown in Figure 14.In conventional PlugX samples, the C2 uses the same algorithm as in the configuration decode (see Figure 11), with part of the key being the first four bytes of the TCP transmission. While the RedDelta PlugX variant also uses the first four bytes of the TCP transmission as a part of the key, the use of RC4 for C2 encryption demonstrates a departure from the usual PlugX C2 traffic encryption mechanism.While Recorded Future has not done extensive code analysis to further compare the samples, we have highlighted fundamental differences between the RedDelta PlugX variants and conventional PlugX, notably in the configuration block and C2 communication. Additionally, while RedDelta has implemented a modular delivery system based on traditional PlugX tactics, it also provides the group with the ability to change, enhance or remove functionality as needed.The file, OneDrive.exe, is responsible for loading the Cobalt Strike payload. When executed, OneDrive will reach out to http://154.213.21[.]27/DotNetLoader40. exe, download the file DotNetLoader40.exe and invoke the “RunRemoteCode” function contained within it. DotNetLoader40.exe is a small .NET executable that essentially downloads and then executes shellcode. The main function in DotNetLoader is “RunRemoteCode” which takes a URL as an argument. The content is downloaded from the provided URL, in this case, http://154.213.21[.]27/beacon.txt, and then sent to the function “InjectShellCode.” The shellcode is then base64 decoded, decompressed, saved to memory, and executed. The shellcode loaded is Cobalt Strike Beacon, which is configured using the Havex Malleable C2 profile. This Havex C2 code has been published on GitHub and can be used by any entity that wishes to use it; and in this case, the attacker is doing so in conjunction with Cobalt Strike. This can be seen both through the URI used within the C2 URL (http://154.213.21[.]70/wp08/wp-includes/dtcla.php) and the client and server headers and HTML content displayed below in Figure 15.The identified Poison Ivy sample is loaded using the above MpSvc.dll file, masquerading as the Microsoft Windows Defender file of the same name. Once loaded, web.miscrosaft[.]com is used for command and control.Our research uncovered a suspected China state-sponsored campaign targeting multiple high-profile entities associated with the Catholic Church ahead of the likely renewal of the provisional China-Vatican deal in September 2020. The CCP’s warming diplomatic relations with the Holy See has been commonly interpreted as a means to facilitate increased oversight and control over its unofficial Catholic church. This also supports the CCP’s wider stated goal of “sinicizing religions” in China. Furthermore, it demonstrates that China’s interest in control and surveillance of religious minorities is not confined to those within the “Five Poisons,” exemplified by the continued persecution and detainment of underground church members and allegations of physical surveillance of official Catholic and Protestant churches. The U.S. Ambassador-at-Large for International Religious Freedom recently expressed concern regarding the impact of the new national security law within Hong Kong, stating it has the “potential to significantly undermine religious freedom.” The targeting of the Catholic diocese of Hong Kong is likely a valuable intelligence source for both monitoring the diocese’s position on Hong Kong’s prodemocracy movement and its relations with the Vatican. This marks a possible precursor to increased limits on religious freedom within the special administrative region, particularly where it coincides with pro-democracy or anti-Beijing positions. RedDelta is a highly active threat activity group targeting entities relevant to Chinese strategic interests. Despite the group’s consistent use of well-known tools such as PlugX and Cobalt Strike, infrastructure reuse, and operations security failures, these intrusions indicate RedDelta is still being tasked to satisfy intelligence requirements. In particular, this campaign demonstrates a clear objective to target religious bodies, and therefore we feel this is particularly pertinent for religious and non-governmental organizations (NGOs) to take note and invest in network defenses to counter the threat posed by Chinese state-sponsored threat activity groups like RedDelta. A lack of ability to invest in security and detection measures for many NGOs and religious organizations greatly increases the likelihood of success for well-resourced and persistent groups, even using well-documented tools, TTPs, and infrastructure.Recorded Future recommends that users conduct the following measures to detect and mitigate activity associated with RedDelta activity: Recorded Future’s research group, Insikt, tracks threat actors and their activity, focusing on state actors from China, Iran, Russia, and North Korea, as well as cyber criminals - individuals and groups - from Russia, CIS states, China, Iran, and Brazil. We emphasize tracking activity groups and where possible, attributing them to nation state government, organizations, or affiliate institutions.Insikt Group names a new threat activity group or campaign when analysts have data corresponding to at least three points on the Diamond Model of Intrusion Analysis with at least medium confidence, derived from our Security Intelligence Graph. We can tie this to a threat actor only when we can point to a handle, persona, person, or organization responsible. We will write about the activity as a campaign in the absence of this level of adversary data. We use the most widely-utilized or recognized name for a particular group when the public body of empirical evidence is clear the activity corresponds to a known group. Insikt Group utilizes a simple color and phonetic alphabet naming convention for new nation state threat actor groups or campaigns. The color corresponds to that nation’s flag colors, currently represented below, with more color/nation pairings to be added as we identify and attribute new threat actor groups associated with new nations. For newly identified cybercriminal groups, Insikt Group uses a naming convention corresponding to the Greek alphabet. Where we have identified a criminal entity connected to a particular country, we will use the appropriate country color, and where that group may be tied to a specific government organization, tie it to that entity specifically. Insikt Group uses mathematical terms when naming newly identified malware.