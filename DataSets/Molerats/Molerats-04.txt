TA402 leverages political and military themes, including the ongoing conflict in the Gaza Strip, to entice users to open attachments and click on malicious links. TA402 activity is largely focused on entities operating in the Middle East, especially government or government-adjacent organizations. TA402’s custom malware called LastConn is used to gain access to and conduct information gathering activities. LastConn uses a number of unique features to deter automated threat analysis and make manual analysis difficult. Proofpoint researchers identified a malware called LastConn distributed by TA402, a threat actor also known as Molerats. The malware targeted government institutions in the Middle East and global government organizations associated with geopolitics in the region. TA402 is a Middle Eastern advanced persistent threat (APT) group that often targets entities in Israel and Palestine, in addition to other regions in the Middle East. In campaigns identified throughout 2021, TA402 leveraged Middle Eastern geopolitical themes including ongoing conflict in the Gaza Strip. The custom malware implant identified by Proofpoint enables the threat actor to conduct reconnaissance on the target host and exfiltrate data. TA402 leveraged multiple mechanisms to avoid automated threat analysis including geofencing based on IP addresses, only targeting computers with Arabic language packs installed, and password-protected archive files to distribute malware. Following a busy 2020 for TA402, Proofpoint researchers identified new and highly targeted email threat campaigns impacting government organizations in the Middle East and entities with diplomatic relationships in the region. Based on Proofpoint visibility, the campaigns occurred on a weekly basis throughout early 2021 before abruptly stopping in March for a two-month hiatus. TA402, also known as Molerats and GazaHackerTeam, resumed email threat campaigns in early June 2021 with continued use of malware Proofpoint dubbed LastConn. Researchers assess with high confidence LastConn is an updated version of SharpStage malware first reported by Cybereason in December 2020. The temporary disruption to email threat operations in March 2021 is interesting and may be due to current tensions in the Middle East region including ongoing violence in the Gaza Strip between Israeli and Palestinian militants or the observation of Ramadan in April through early May 2021, one of the most important religious holidays for Muslims. However, Proofpoint cannot confirm either hypothesis with high confidence. TA402 has been active since at least 2011 and is believed to be operating out of the Middle East. The group’s targeting includes but is not limited to targets in Israel and Palestine. [3,4] TA402 is known to target multiple industry verticals such as technology, telecommunications, financial institutions, academic institutions, military installations, media outlets, and government offices. The primary motivation of this group is to collect sensitive information and documents from high values targets to gather intelligence. Proofpoint assesses with moderate confidence based on lure topics, targeting, and historic campaigns the activity likely supports military or Palestinian state objectives. TA402 used spear-phishing emails containing either malicious links or attachments in the recently observed campaigns. In June campaigns, TA402 leveraged a PDF attachment with one or multiple geofenced URLs leading to password-protected archives that contained the malware. The email and the PDF are typically both written in Arabic, and the lure is usually based on a geopolitical topic impacting the Middle East, especially the Gaza conflict. Proofpoint observed lure themes including “A delegation from Hamas meets with the Syrian regime” and “Hamas member list”. The password of the RAR file can be found inside the text of the PDF. Extracting the archive reveals a custom TA402 implant. In recent campaigns, the archive dropped LastConn malware. Other observed malware distributed by this attack path include SharpStage, Loda, and MiraiEye RAT. A payload is not immediately downloaded. Proofpoint researchers were unable to determine the exact mechanisms for initiating links to the hosted malware, but the PDF may only direct the victim to the files if the source IP address belongs to the targeted countries in the Middle East. If the source IP address does not align with the target group, the URL may redirect the recipient to a benign decoy website, typically an Arabic language news website. The password protection of the malicious archive and the geofenced delivery method are two easy anti-detection mechanisms threat actors can use to bypass automatic analysis products. Another initial access vector inside TA402’s 2021 arsenal observed in February is the use of Google Apps Script URLs directly inside the spear-phishing email. Google Apps Script is a development platform based on JavaScript that allows both the creation of standalone web apps and powerful extensions to various elements of the Google Apps software-as-a-service ecosystem. Proofpoint has previously observed multiple threat actors leveraging this method of malware distribution via URLs. In the identified TA402 campaign, the script also redirects to a password protected archive or to a benign decoy website based on the geofencing mechanism. Some Google App Script URLs Proofpoint observed in this campaign also require a legitimate login to a Google account before they can be accessed. Example URL from 16 February 2021 URL campaign: hxxps://script[.]google[.]com/macros/s/AKfycbxhRyJqO682mzT4C3-aNwSULjNPuHvhqpGYElJedUBPfaG60fZSOEQ/exec.TA402 has been using a malware that Proofpoint tracks as LastConn in recent email-based campaigns. It is an updated version or new variant of the malware that Cybereason calls “SharpStage” and analyzed in December 2020. LastConn malware is specifically targeted at computers with an Arabic language pack installed to ensure it only infects specific targets. It uses Dropbox for all command and control (C2) capabilities and infrastructure. Proofpoint researchers assess LastConn is very actively developed and maintained malware. It features multiple capabilities that attempt to prevent both automated and manual malware analysis. Both samples use third-party .NET code obfuscators. The sample in February used an unknown obfuscator that the de4dot deobfuscator was unable to deobfuscate. While de4dot could not fully deobfuscate this one either, it was able to clean up some of the obfuscations. Strings in the malware and its included components were stored encrypted inside a .NET resource. A 32-byte key was stored as a stack string with multiple character replacements and is used with an unknown decryption algorithm. Once the resource is decrypted strings are referenced by an index. We have included a list of decrypted strings and their index values on our Proofpoint Threat Research GitHub. In addition to the code obfuscator anti-analysis mechanisms, the LastConn malware requires mouse clicks and an Arabic language pack to be installed on the victim’s computer before it will continue executing its malicious functionality: The first time LastConn runs, a “RunFileOnes” function is executed. This function uses the legitimate Dropbox API and the “txt_TokenRunOne” authentication token to download the “txt_FileOpen” file to “txt_PathDir”. This file is then opened, and Proofpoint researchers believe it is used to display a decoy document. The February decoy document was named “hamas.docx” and looked like: The decoy document for the June campaigns, “news.doc”, was not available at the time of research. After the decoy document functionality, a “StartFolder” function is executed. Using the Dropbox API and the “txt_MyToken” authentication token a working directory is created on the malware’s Dropbox named “”. An empty “txt_FileToDown” file is then uploaded to the working directory. Proofpoint researchers believe this empty file is used to signal that the malware has been initialized and is ready to execute commands. The final broad function is called “GetUpload” and is used to do several things. First, it maintains the “txt_LastConn” malware activity log mentioned in the “Naming” section above. Second, it downloads the “txt_Setting” file which contains a third Dropbox authentication token used for command handling. If this file cannot be downloaded, a new “txt_MyToken” is fetched from Pastebin sites and the download is tried again. At the time of research, the content of the configured Pastebin URLs were unavailable: Third, it downloads the legitimate RAR utility file Rar.exe and “txt_FileName”.rar file. Once a command is executed, its entry is removed from the “txt_FileToDown” file and the file is re-uploaded to the malware’s Dropbox. TA402 is a highly effective and capable threat actor that remains a serious threat, especially to entities operating in and working with government or other geopolitical entities in the Middle East. Researchers anticipate TA402 will remain very active, based on its return to weekly threat activity as of June 2021. It is likely TA402 continue its targeting largely focused on the Middle East region. Proofpoint assesses TA402 will continue to develop and modify customized malware implants and include features to evade detection and automated analysis. To defend against exploitation, Proofpoint recommends recipients pay close attention when downloading and opening password protected archives, and only open them from trusted sources. Proofpoint’s Threat Research team developed Emerging Threat rules to detect post infection network traffic.