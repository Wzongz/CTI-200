Charming Kitten is an Iranian cyberespionage group operating since approximately 2014. This report exposes their vast espionage apparatus, active during 2016-2017. We present incidents of company impersonation, made up organizations and individuals, spear phishing and watering hole attacks. We analyze their exploitation, delivery, and command-and-control infrastructure, and expose DownPaper, a malware developed by the attackers, which has not been publicly documented to date. Incidents documented in this report are likely a small fraction of the actual amount of targeted attacks, which may reach thousands of individuals. We expose more than 85 IP addresses, 240 malicious domains, hundreds of hosts, and multiple fake entities – most of which were created in 2016-2017. The most recent domains (com-archivecenter[.]work, com-messengerservice[.]work and com-videoservice[.]work) were registered on December 2nd, 2017, and have probably not been used in attacks yet. We present the connection between Behzad Mesri, an Iranian national recently indicted for his involvement in hacking HBO, and Charming Kitten. We also identify other members of the group. This report refers to two likely distinct groups, Charming Kitten and Rocket Kitten, together. This is not to say that the two groups are one, but that due to overlap in infrastructure, tools, targets, and modus operandi we are unable to precisely attribute each incident to one or the other. Further discussion appears in the section "Charming Kitten or Rocket kitten?"The attackers' focus appears to be individuals of interest to Iran in the fields of Academic research (i.e. Iranists - Scholars who study Iran), Human right and media. Emphasis is given to Iranian dissidents living in Iran or abroad, and people who come in touch with Iranians or report on Iranian affairs such as journalists and reporters, media outlets covering Iran, and political advisors. Most targets known to us are individuals living in Iran, the United States, Israel, and the UK. Others live in Turkey, France, Germany, Switzerland, United Arab Emirates, India, Denmark and other countries. Notably, the attackers usually try to gain access to private email and Facebook accounts. They seek to infiltrate the targets’ social network as a hop point to breach other accounts in their social network, or to collect information about their targets. Sometimes, they aim at establishing a foothold on the target’s computer to gain access into their organization, but, based on our data, this is usually not their main objective, as opposed to other Iranian threat groups, such as Oilrig1 and CopyKittens2 . While Iranian threat actors have been well documented by security researchers, the inner workings of the ecosystem of Iran's hackers is not entirely clear. Groups can be vigorously active for years and then disappear abruptly, sometimes due to being publicly outed. Researchers make a best-faith effort to assign operations to certain groups, but the instability in the field makes the process challenging. A case of these obscure lines can be found in a blogpost published in coordination and parallel to this report -“Flying Kitten to Rocket Kitten, A Case of Ambiguity and Shared Code”3 by Collin Anderson and Claudio Guarnieri. Flying Kitten (which is another name given by the security industry to Charming Kitten) was one of the first groups to be described as a coherent threat actor conducting operations against political opponents of the IRI (Islamic Republic of Iran) government and foreign espionage targets. FireEye’s publication of “Operation Saffron Rose” report, which described Flying Kitten’s operations against aviation firms, led to the dismantling of Flying kitten's infrastructure and the apparent end of its activities. Months later, another, seemingly distinct group, “Rocket Kitten,” would be described by a series of reports. While the two groups exhibited different behaviors that lend credence to the assumption they were distinct, disclosures of private toolkits strongly suggest that Rocket Kitten had used Flying Kitten resources throughout its credential-theft operations. Moreover, Rocket Kitten had experimented with reusing malware that appeared to be an undisclosed precursor to Flying Kitten's “Stealer” agent documented by FireEye. These overlaps provide some indication that Rocket Kitten had some relationship to Flying Kitten – perhaps members of the latter joining the new team. Rocket Kitten has since largely subsided as a formidable actor, and repeating the theme of its predecessor now only appears in echoes of other campaigns. Read -“Flying Kitten to Rocket Kitten, A Case of Ambiguity and Shared Code” here: https://iranthreats.github.io/resources/attribution-flying-rocket-kitten. Further information is available in "Appendix B - Previous reports about Charming Kitten and Rocket Kitten". In November 21, 2017, the United States Department of Justice unsealed an indictment4 against Behzad Mesri (A.K.A “Skote Vahshat”) 5 for his involvement hacking and extorting HBO, and for subsequently leaking the stolen content on the Internet. Leaked content included confidential information about upcoming episodes of the popular television series, “Game of Thrones,” and video files containing unreleased episodes of other television series created by HBO6 .According to the indictment, "Mesri is an Iran-based computer hacker who had previously worked on behalf of the Iranian military to conduct computer network attacks that targeted military systems, nuclear software systems, and Israeli infrastructure. At certain times, Mesri has been a member of an Iran-based hacking group called the Turk Black Hat security team". Connection to Iranian government backed threat agent Security researcher Collin Anderson of Iran Threats7 tagged Mesri's twitter account8 in a tweet9 suggesting that Mesri might be related to Charming Kitten. Subsequently, we tried to find connections of Mesri to other activities and people mentioned in this report. Thanks to the public nature of how Mesri and other members of Turk Black Hat conducted their hacking activities and private online life, we could find several connections. This is not to say that the HBO hack was ordered by the Iranian government. Rather, we try to strengthen the assumption that Mesri was, at a certain time, part of, or related to Charming Kitten. In addition, we unmask other members of the group based on their connection to Mesri and to Charming Kitten infrastructure.ArYaIeIrAN (AKA aryaieiran@gmail.com AKA aryaieiran@hotmail.com AKA mno_1988_fgh@yahoo.com) is a 29 years old Iranian hacker and member of Turk Black Hat. Below is his profile page in "Iranian engineers club" 10:The same email address, aryaieiran@gmail.com, shows up in the SOA (Start of Authority) record of multiple domains registered and used by Charming Kittens that are presented in this report. These include britishnews.com[.]co, britishnews[.]org, broadcastbritishnews[.]com and mehrnews[.]info. All these websites used persiandns[.]net as their NS (name server), as can be seen in PassiveTotal:To sum up, the HBO hacker - Behzad Mesri is a member of Turk Black Hat along with ArYaIeIrAn, who provides infrastructure for Charming Kitten activity via PersianDNS / Mahanserver together with Mohammad Rasoul Akbari, who is a Facebook friend of Behzad Mesri's. We tend to identify ArYaIeIrAn with Mohammadamin Keshvari, because the latter is the only other employee of Mahanserver and works in a company whose domain was registered by the former (and both have a similar and unique profile picture). We estimate with medium certainty that the three are directly connected to Charming Kitten, and potentially, along with others – are Charming Kitten. We used SocialNet, Shadow Dragon’s Maltego transform for social media analysis17 to analyze these connections and visually depict them, as can be seen below：Charming kitten regularly target international media outlets with Persian-language services. Two recent reports – "How Iran tries to control news coverage by foreign-based journalists" 18 and "Iranian agents blackmailed BBC reporter with ‘naked photo’ threats" 19 describe harassment and intimidation methods applied by Iranian intelligence agencies. These campaigns often target reporters and journalists in phishing attempts. On the same note, we identified a fake-news agency "established" by the attackers, called “The British news agency” or “Britishnews” (inspired by BBC)20 . Its website domain is britishnews.com[.]co and two other domains, broadcastbritishnews[.]com and britishnews[.]org, redirected to it. Below are screenshots of the main page of the website, which is online at time of writing:Note the use of present perfect instead of past simple in "has been established" (instead of "was established"), present progressive (we are covering) instead of present simple (we cover) to mark a habitual aspect, and "began this work" – all suggesting a Persian-thinking writer. This fake news-agency and accompanying social media accounts are not used to disseminate propaganda or false information. Their content was automatically copied from legitimate sources. The purpose of this news agency is to create legitimacy, with the end goal of reaching out to their targets and infecting them while visiting the infected website. The website contains BeEF (Browser Exploitation Framework – a penetration testing tool that focuses on web browsers), however it seems that the payload is sent only when the victim visits the site from IPs in a whitelist managed by the attackers. This might indicate they are after specific targets or organizations rather than widespread infection. The screenshot below shows w3school.hopto[.]org, which served BeEF, called when britishnews.com[.]co is loading: Multiple Israeli Iranist and middle east researchers were sent emails and Twitter direct messages by made up entities. These entities are reviewed below."Yafa" also sent an email from yaffa.hyatt9617@gmail.com to a university professor, asking to work at the university center she is heading. The email itself did not contain malicious content, and was likely sent to build trust prior to sending a phishing link or malware: Fake entity "Bahar Azadeh" (bahra.azadeh88@gmail.com and @baharazadeh122 , online at time of writing) sent emails with different background stories to multiple researchers. In two cases, she was a "Jewish girl who has an Iranian origin and who has studied in the field of political science":The attackers created a website impersonating UTC (United Technologies), “an American multinational conglomerate which researches, develops and manufactures products in numerous areas, including aircraft engines, [and] aerospace systems […]. UTC is a large military contractor, getting about 10% of its revenue from the U.S. government” 23 . The fake website was first reported by Iran Threats researchers on 6 February 201724. We do not have evidence that UTC was targeted or impacted. The fake website, which was built in January 2017, claimed to offer “Free Special Programs And Courses For Employees Of Aerospace Companies like Lockheed Martin, SNCORP, ….”. It was a decoy to make visitor download a “Flash Player”, which was in fact DownPaper malware, analyzed later in this report.The attackers sent hundreds, maybe thousands, of spear phishing emails to hundreds of targets. In this section, we will present samples of spear phishing emails25 . The attackers breached the Gmail account of Alon Gur Arye, an Israeli film producer. Alon produced a satire film about the Israeli Mossad, which potentially confused the attackers to thinking he is associated with the Israeli Mossad. The breached account was used to send a phishing email to Thamar Eilam Gindin (who is targeted by the group since 201526). Below is a screenshot of the phishing email:The email contained a shortened bit.ly link to a domain registered by the attackers - drivers.documentsupportsharing[.]bid. In the statistics and usage page of the bit.ly URL we can see that the first click, likely a test run performed by the attackers before sending the phish, was from Iran.Sometimes the phishing email does not contain live text, but only an image of text linked to a phishing page. This is usually done to bypass text based spam filters. The attackers used WebRTC (code copied from Github27) to detect the real IP address of targets who use proxies (This method was documented by Iran Threats28):While sending the spear phishing, the attackers preformed password recovery on the target’s Facebook account, as can be seen below. Thus, she received fake emails and legitimate ones at the same time which could cause her confusion and subsequently to give her credentials in the phishing.The attackers often open a new Gmail account and send phishing emails from it. For example, suspended.user.noitification@gmail.com was used to send the following email to targets:The attackers often use mailtrack.io to track when phishing emails are opened. These services are often used by marketing people to monitor their campaign effectiveness. Below is the source code of a spear phishing email with a mailtrack.io tracking link:Sometimes the attackers used a similar email tracking service, by Pointofmail. In this case, the malicious email was sent from Pointofmail’s servers (this is part of their service, not due to a breach). The email contained a redirect link to legitimate address advmailservice.com：Email address customers.mailservice@gmail.com was mostly used for spear phishing. Occasionally, it was used to deliver links to malware. For example, the email below linked to http://tinyurl[.]com/hjtaeak which redirected to http://login.radio-m[.[cf/i/10-unique-chocolates-in-the-world.zip. The final URL contained the same sample of DownPaper that was hosted in the fake UTC website mentioned above (be207941ce8a5e212be8dde83d05d38d).Note, that the person who “shared” the file with the target in the malicious email was indeed a Facebook friend of the target (the target shared a link by her a few hours prior to receiving this message), and the subject of chocolate was trending on the target's feed at the time. The attackers spied on the target (potentially by following her on various social networks), and crafted an email she would be likely to receive. DownPaper, sometimes delivered as sami.exe, is a Backdoor trojan. Its main functionality is to download and run a second stage. The sample used in our analysis (3261d45051542ab3e54fa541f132f899) was contained in a Cabinet selfextractor (be207941ce8a5e212be8dde83d05d38d), served from the following URL: By pivoting off the malicious infrastructure we found a sample of MAGICHOUND.RETRIEVER, a malware which is covered in a report by Palo Alto Networks about a group they call Magic Hound37 . The report says that Magic Hound “has primarily targeted organizations in the energy, government, and technology sectors that are either based or have business interests in Saudi Arabia”. Also, “Link analysis of infrastructure and tools […] revealed a potential relationship between Magic Hound and the adversary group called ‘Rocket Kitten’”. The last notion is in line with our findings. MAGICHOUND.RETRIEVER is a .NET downloader that retrieves secondary payloads using an embedded URL in its configuration as the C2. Below is the sample that we found.