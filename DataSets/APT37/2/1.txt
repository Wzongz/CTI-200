A one year review of campaigns performed by an actor with multiple campaigns mainly linked to South Korean targets. This article exposes the malicious activities of Group 123 during 2017. We assess with highconfidence that Group 123 was responsible for the following six campaigns: On January 2nd of 2018, the "Evil New Year 2018" was started. This campaign copies theapproach of the 2017 "Evil New Year" campaign. The links between the different campaigns include shared code and compiler artifacts such asPDB (Program DataBase) patterns which were present throughout these campaigns. Based on our analysis, the "Golden Time", both "Evil New Year" and the "North Korean HumanRights" campaigns specifically targeted South Korean users. The attackers used spearphishing emails combined with malicious HWP documents created using Hancom HangulOffice Suite. Group 123 has been known to use exploits (such as CVE-2013-0808) or scriptingLlanguages harnessing OLE objects. The purpose of the malicious documents was to install andto execute ROKRAT, a remote administration tool (RAT). On occasion the attackers directlyincluded the ROKRAT payload in the malicious document and during other campaigns theattackers leveraged multi-stage infection processes: the document only contained adownloader designed to download ROKRAT from a compromised web server. Additionally, the "FreeMilk" campaign targeted several non-Korean financial institutions. In this.campaign, the attackers made use of a malicious Microsoft Office document, a deviation fromtheir normal use of Hancom documents. This document exploited a newer vulnerability, CVE.2017-0199. Group 123 used this vulnerability less than one month after its public disclosure.During this campaign, the attackers used 2 different malicious binaries: PoohMilk and FreenkiPoohMilk exists only to launch Freenki. Freenki is used to gather information about theinfected system and to download a subsequent stage payload. This malware was used inseveral campaigns in 2016 and has some code overlap with ROKRAT. Finally, we identified a 6th campaign that is also linked to Group 123. We named this 6thcampaign "Are You Happy?". In this campaign, the attackers deployed a disk wiper. Thepurpose of this attack was not only to gain access to the remote infected systems but to alscwipe the first sectors of the device. We identified that the wiper is a ROKRAT module.n This actor was very active this year and continued to mainly focus on South Korea. The groupleveraged spear phishing campaigns and malicious documents the contents of which includedvery specific language suggesting that they were crafted by native Korean speakers rather than.through the use of translation services. The actor has the following demonstrated capabilities:As with the majority of Group 123 campaigns, the initial attack vector during this campaign wasspear phishing. Talos identified two different kinds of emals. The first email we discovered was.the most interesting. In this sample, we observed the altackers praising the user for joining apanel related to the "Korean Reunification and North Korean Conference". The text in the email0explained that the recipient should complete the attached document to provide necessaryfeedback. This appears to be a non-existent conference. The closest match we identifiedrelated to any Unification conference was held in January 2017, which was the NYDADReunification conference. The sender was &gf2016@yonsei.ac.kr' which is the contact email ofthe Korea Global Forum, a separate conference. When we analyzed the email headers, we determined that the email was sent from an SMTPserver using an lP associated with the Yonsei Universily network. We believe that the emailaddress was compromised and abused by the altackers to send the email used in thiscampaign. The filename for the malicious attachment translates as "Unification North Korea Conference Examination Documents' which reinforces the text in the email about the reunificationconference. For an added bonus, in the body of the email, the attacker even suggests thatpeople who completed the document would get paid a 'small fee'. Perhaps the gift ofembedded malware is the payment:Much less effort was used to craft the second email Talos analyzed. The email was from a freeKorean mail service provided by Daum, Hanmail, indicating that there was no attempt to try toappear as if it originated from an official body or person, unlike the previous email described.The subject was simply 'Request Help' while the altachment filename was '"'m a munchon0person in Gangwon-do, North Korea'. We suspect the altacker was trying to generatesympathy by reminding the reader that Munchon and the province it is in, Kangwon, were partof a unified province that included South Korea's Gangwon-do prior to the division of Korea in1945. A second email contained a story about a person called 'Ewing Kim' who was looking for help:The email's attachments are two different HWP documents, both leveraging same vulnerability (CVE-2013-0808). This vulnerability targets the EPS (Encapsulated PostScript) format. The purpose of the shellcode is to download a payload from the Internet. The first email displays he following decoy document to the infected user and download the following payload: In both cases, the downloaded payload is the ROKRAT malware. The first tasks of this variant of ROKRAT is to check the operating system version. lf WindowsXP is detected, the malware executes an infinite loop. The purpose is to generate empty.reports if opened on sandbox systems running Windows XP machines. Additionally it checks todetermine if common analysis tools are currently running on the infected system. if it detectsthe presence of these tools, the malware performs two nelwork requests to legitimate websites:One of the identifying characteristics of ROKRAT is the fact that it uses social network and cloud platforms to communicate with the attackers. These platforms are used to exfiltrate documents and receive instructions. Here is a list of the platforms used by this variant: Twitter, Yandex and Mediafire. The tokens for each platform are hardcoded within the sample.In the early part of 2017, Group123 started the "Evil New Year" campaign. In this campaign theactors tried to fool victims by pretending the emails were from the Korean Ministry ofUnification and that they offered Korean-specific analysis. mhis campaign began with a handfulof spear phishing emails to South Korean targets and containing malicious attachments.Group123 further attempted to entice victims to open the attachments by using commonHancom Hangul documents. Hancom's Hangul is a popular Office Suite used primarily in the.Korean peninsula. The use of Hangul office documents has the advantage of being the normfor the Korean peninsula. lf the attacker used Microsoft documents, it may have raisedsuspicions in the victim. Given the regional file format used there is a chance that somelsecuritly software suites may not handle them well, and this may have provided an evasioncase for the attacker. The documents sent to the targets were titled "Analysis of "Northern New Year in 2017" andused the official logo of the Korean Ministry of Unification. This is a simple choice for the actorto make, but it further shows their familiarity with the region.The document claimed to discuss the New Year's activities of North Korea and this would have been something that the victims in South Korea would be very interested in. This would have been particularly true for Government targets, who we believe to be Group123's target of choice.This document was a decoy aimed to entice the user to open malicious documents embedded further down the page.The actor embedded two additional links and the document urged the user to click on theselinks for more information about New Year's activities in North Korea. The first link was labeledas "Comparison of Major Tasks in '16 & '17" and the second link was identified as "Comparisonbetween '16 &'17" Upon opening these links the user was presented with a further decoy Hangul document. Thisdocument was well written and further increases our confidence that we are dealing with a newKorean actor. These documents contained malicious OLE objects used to drop binaries.Initial analysis showed some sloppy cleaning up from Group123, which we used later to determine that separate campaigns were the work of this same actor, as compilation artifacts remained within the binaries:The second stage of the dropped binaries was used to execute wscript.exe while injecting shellcode into this process. The shellcode is embedded within the resource 'BIN' and is used to unpack another PE32 binary and use wscript.exe to execute it. To do this, Group123 uses a well-known technique that harnesses VirtualAllocEx(), WriteProcessMemory() and CreateRemoteThread() Windows API calls.The new PE32 unpacked from the shellcode is an initial reconnaissance malware which is used to communicate with the C2 infrastructure to obtain the final payload. The information this malware collected included the following: Group123 utilized this method to ensure their victim was (a) someone they wanted to target further and (b) someone they could infect further based on the information obtained from the reconnaissance phase. Further network analysis showed that the binary attempted to connect to the following URLs: Korean Government Legal Services (KGLS) is a legitimate Korean government body thatmanages Korean government legal affairs. By compromising the KGLS, the attacker gained atrusted plalform from which to execute an attack. The initial network connection is to "index.php'. This connection transmits the informationgathered during the reconnaissance phase. The attacker uses this information to thendetermine the specific filename (based on the random lD) to serve to the infected victim. in ourcase this was 02BC6B26 - this meant a file "02BC6B26_put.jpg" was created for us on theattackers C2. This file is then dropped and renamed 'officepatch.exe' on the victim's machine..Because the attacker was careful about who they attacked, we were unable to obtain this file during our analysis. During our investigation we were able to identify additional Command and Controlinfrastructure used by this actor. Four C2s were observed, based in the following countries:Contrary to the previous campaign, the attackers separated the reconnaissance phase from the main ROKRAT payload. This trick was likely used to avoid detection. This is an interesting adaptation in Group 123's behavior.In March 2017, Group 123 compiled a disk wiper. The malware contains 1 function, the purpose is to open the drive of the infected system (\\.\PhysicalDrive0) and write the following data to the MBR:As you can see, it perfectly matches the ROKRAT PDB. This wiper is a ROKRAT module named ERSP.enc. We assume that ERSP means ERaSePartition. This module can be downloaded and executed on demand by Group 123. This sample is interesting considering the attack in December 2014 against a Korean power plant where the message that was displayed by the wiper was "Who Am I?".This campaign targeted non-Korean financial institutions, but unlike the other campaigns, this.one does not use HWP documents. lt instead uses Office documents. This change is becauselGroup 123 did not target South Korea during this campaign and Microsoft Office is standard inthe rest of the world.The attackers exploited CVE-2017-0199 in order to download and execute a malicious HTA document inside of Microsoft Office. The URL used can be found in the embedded OLE object.The first action is to create a registry key in order to execute the mindows-KB275122-x86.exeile previously downloaded. The file is executed with the argument: "help". Here is the registry.The registry location where persistence is achieved is:HKCUSoftware\MicrosoftWindowsiCurrentVersion'RuniWindows Update. At the next reboot.the malware will be executed. The second action is to check if the file "wsatra.tmp" exists in the temporary directory of the.current user. lf this file exists, the content is read in order to obtain a path to find a second filewith the LNK (link) extension. The LNK file is finally used to identify a third file: a ZlP file. Thenfile will be inflated in order to retrieve a RTF document, this document will be displayed to the. infected user by executing Wordpad.Additionally the malware lists the running process via the Microsoft Windows API. The malware uses obfuscation in order to hide strings such as URL or User-Agent, the algorithm is based on bitwise (SUB 0x0F XOR 0x21), here is the decoded data:In November 2017, Talos observed the latest Group123 campaign of the year, which included anew version of ROKRAT being used in the latest wave of attacks. Group 123 again used oneof their main calling cards, the malicious HWP document. This time, Group 123 used adocument containing information in relation to a meeting held on ist November in Seoul, SouthKorea. This document was alleged to have been written by a legal representative claiming tobe representing the "Citizens' Alliance For North Korean Human Rights And Reunification Of0Korean Peninsula". Group 123 once again uses information related to the Korean unification.and now are claiming to highlight concerns related to human rights issues. The document brought Talos a new gift - a new version of ROKRAT. Following on with thenormal Group 123 activity the document was written in perfect Korean text and dialect againsuggesting the origin of this group is from the Korean peninsula.Further analysis of the document text allowed us to understand the context. The documentmentions 'Community of North Korean human rights and unification' with the lawyer claiming tobe part of the "Citizen's Aliance for North Korean Human Rights and North-South unification".0The main purpose of this document was an attempt to arrange a meeting to discuss itemsrelated to "North Korean Human Rights Act" and "Enactment of a Law" which was passed in2016 in South Korea. We believe that the document was attempting to target stakeholderswithin the '9l5' community in an attempt to entice them to join the discussion in an attempt towork on additional ideas related to these activities. The meeting was due to take place onNovember 1, 2017 and this document was trying to garer additional interest prior to themeeting. Once again Group 123 leveraged the use of OLE objects within the HWP document. Analysisstarts with a zlib decompression (a standard action of HWP documents) and we're able torecover the following script:This script is executed and is used to decode a static base64 string within the strEncodevariable. Using base64 encoding the decoded binary is stored as HncModuleUpdate.exe andis then executed. This is the ROKRAT dropper. Talos suspect the filename may have beenselected to make it appear within running processes as a potential Hancom updater. The dropper is used to extract a new resource named SBS. This specific resource containsmalicious shellcode used by the malware. Additionally we see a cmd.exe process launchedand used for process injection using the VirtualAlloc(), WriteProcessMemory() andCreateRemoteThread( Windows APls, as with the first finding of ROKRAT they continue toDuse similar Windows APls. The following graph view from lDA shows these steps.These execution steps allow the launch of the new ROKRAT variant by decoding the PE binaryand injecting into the cmd.exe process. Dne of Group 123 oddities in this campaign was to drop the following picture as a decoy imageto the user. This image shows various publicly available images which look to be related to theKorean 'independence Movement' and appear to be related to the Korean war.We began performing further in-depth analysis on this new version of ROKRAT and this is where we started to notice some similarities with Group 123s "Evil New Years" campaign. The similitudes are discussed later in this paper. This ROKRAT variant contained anti-sandbox techniques. This is performed by checking if the following libraries are loaded on the victim machine. nop dword ptr [eax+eax+00h] is a 5 byte NOP. But this opcode is not correctly supported bysome debugging tools, lmmunitly Debugger for example, will replace the assembly by "???" inred making it difficult to attempt to debug.. This version of ROKRAT came with a Browser Stealer mechanism which was similar, with afew modifications, to that used in the FreeMilk campaign using Freenki malware in 2016.0 Group 123 continued their use of Cloud platforms with this campaign, this time leveragingpCloud, Dropbox, Box and Yandex. Finally here is the PDB of the sample used during this campaign:As we observed at the beginning of 2017, Group 123 started a campaign corresponding with the new year in 2018. This campaign started on the 2nd of January. The infection vector was a malicious HWP document:This decoy document is an analysis of the 2018 New Year speech made by the leader of NorthKorea. The approach is exactly the same as what was seen in 2017 using a new decoydocument. This document was alleged to have been written by the Ministry of Reunification asdemonstrated by the logo in the top left. Similar to the "Golden Time" campaign, this document exploits an EPS vulnerability in order todownload and execute shellcode located on a compromised website:Talos has identified that Group 123 shares code between different malware. Several features are shared in the samples mentioned in this article; however we will cover only two in this article: the reconnaissance phase and the browsers stealer The ROKRAT samples used during the two "Evil New Year" and the "North Korean Human Rights" campaigns contained a reconnaissance phase. In the "Evil New Year" campaign the payload was split into two parts, the first part contained the reconnaissance code. In the other campaign the reconnaissance phase was directly included in the main payload. This code is the same. The malware uses the following registry key to get the machine type: HKLM\System\CurrentControlSet\Services\mssmbios\Data\SMBiosData. The "System manufacturer" value is used to identify the type of machine. The code appears to be based on a forum post (rohitab.com) describing the use of the Win32 APIs used. The source code only considers the following machine types:The string format - with the () - and the considering types are exactly the same as those used in the ROKRAT samples. It's interesting to note that this reconnaissance phase was not included in the ROKRAT variant used during the "Golden Time" campaign.For the first time, the ROKRAT sample used during the "North Korean Human Rights" contained a browser credentials stealer. The code used to perform this task in the same that found within in a Freenki sample deployed in 2016. The malware is able to extract the stored passwords from Internet Explorer, Chrome and Firefox. For Chrome and Firefox, the malware queries the sqlite database containing the URL, username and password Additionally, they support the Microsoft Vault mechanism. Vault was implemented in Windows 7, it contains any sensitive data (like the credentials) of Internet Explorer. Here is the initialization of the Vault APIs On the left, we have the ROKRAT sample and on the right the FreeMilk sample. You can see that in addition to the code, the author copy-pasted English typos such as "IE Registery":We can clearly identify a pattern in the PDB naming convention of all the binaries mentioned in this article. South Korea is becoming an important target for malicious actors and the techniques used arebecoming specific to the region (for example: use of native language to try and ensure thetargets feel that the information, document or email being sent to them has added legitimacy).In a specific campaign, this actor took time to compromise multiple legitimate Korean platformsincluding Yonsei and the KGLS in order to forge the spear phishing campaign or to host thecommand and control. This approach is not common with less advanced actors anddemonstrates a high level of maturity and knowledge of the Korean region. However Group 123's activities are not limited to South Korea. For international targets, theyare able to switch to a more standard attack vector such as using Microsoft Office documents.as opposed to the specific HWP documents used when targeting victims located in Korea.nGroup 123 does not hesitate to use public exploits and scripting languages to drop andexecute malicious payloads. We can notice that this group uses compromised legitimatewebsites (mainly Wordpress) and cloud platforms to communicate with the infected systems.This approach makes it difficult to detect communications through analysis of these network.flows. Even if the arsenal of this actor is diverse, we have identified some patterns, copy-paste.code from various public repositories and similarities between the different piece of code. inaddition to the Remote Administration Tools, we identified a wiper. We conclude that this groupwas involved in a campaign of intelligence gathering and finally attempted destruction.. With our current knowledge of this actor, we predict that they will not disappear anytime soonand will continue to be active during the coming years. Group 123 is constantly evolving as thenew fileless capability that was added to ROKRAT demonstrates. We also believe their target protle may change but for now it wil mostly focus on Korean peninsula targets, however, asl explained their capabilities will likely continue to evolve over time as they further refine their0 TTPS.