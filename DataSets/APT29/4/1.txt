This report provides further details of Tactics, Techniques and Procedures (TTPs) associated with SVR cyber actors. SVR cyber actors are known and tracked in open source as APT29, Cozy Bear, and the Dukes. UK and US governments recently attributed SVR’s responsibility for a series of cyber-attacks, including the compromise of SolarWinds and the targeting of COVID-19 vaccine developers. Alongside this attribution, the United States’ National Security Agency (NSA), Federal Bureau of Investigation (FBI), and Cybersecurity and Infrastructure Security Agency (CISA) released an advisory detailing the exploits most recently used by the group. The FBI, Department of Homeland Security (DHS) and CISA also issued a joint report providing information on the SVR’s cyber tools, targets, techniques, and capabilities. The SVR is Russia’s civilian foreign intelligence service. The group uses a variety of tools and techniques to predominantly target overseas governmental, diplomatic, think-tank, healthcare and energy targets globally for intelligence gain. The SVR is a technologically sophisticated and highly capable cyber actor. It has developed capabilities to target organisations globally, including in the UK, US, Europe, NATO member states and Russia’s neighbours. The NCSC, NSA, CISA and CSE previously issued a joint report regarding the group’s targeting of organisations involved in COVID-19 vaccine development throughout 2020 using WellMess and WellMail malware. SVR cyber operators appear to have reacted to this report by changing their TTPs in an attempt to avoid further detection and remediation efforts by network defenders. These changes included the deployment of the open-source tool Sliver in an attempt to maintain their accesses. The group has also been observed making use of numerous vulnerabilities, most recently the widely reported Microsoft Exchange vulnerabilities. As previously reported, the group frequently uses publicly available exploits to conduct widespread scanning (T1595.002) and exploitation (T1190) against vulnerable systems. The group seeks to take full advantage of a variety of exploits when publicised. The group has used:This list should not be treated as exhaustive. The group will look to rapidly exploit recently released public vulnerabilities which are likely to enable initial access to their targets. More information about these exploits can be found in previous NCSC advisories on Citrix and VPN vulnerabilities. Most recently, the group has also scanned for Microsoft Exchange servers vulnerable to CVE-2021-26855. Such activity is typically followed by the use of further exploits and deployment of a webshell (T1505.003) if successful. Other Microsoft Exchange exploits commonly used in conjunction with this CVE include: More information about these exploits and mitigation advice can be found on the NCSC website.The SolarWinds campaign demonstrates the actor’s willingness to target organisations that supply privileged software (T1195.002), such as network management or security applications, to many users or organisations. These types of attacks give SVR actors initial access to a large number of organisations. From this initial access, the actors select a much smaller number of victims for follow-on compromise activity. These victims are targeted in line with intelligence priorities. Enterprise products and applications deployed across multiple organisations will be attractive supply chain targets. Products which require access to a significant portion of user or network data to operate are likely to be especially attractive targets. Earlier this year Mimecast and SolarWinds acknowledged compromises, now known to be conducted by SVR cyber operators. NCSC and partner industry analysis shows that on multiple occasions, SVR actors used Cobalt Strike, a commercial Red Team command and control framework, to carry out their operations after initial exploitation (e.g. compromise of SolarWinds platform). The group also deployed GoldFinder, GoldMax and Sibot malware after compromising a victim via SolarWinds. GoldMax is a custom backdoor, GoldFinder is a custom tool – both are written in Golang. Sibot is a simple custom downloader and, unlike other malware in recent use by the group, is written in VBS (T1059.005). Microsoft’s analysis of this malware can be found here. In separate incidents, the NCSC observed that once SVR actors had gained initial access to a victim’s network, they then made use of the open-source Red Team command and control framework named Sliver. Following the publication of the joint WellMess Advisory SVR cyber operators used the Sliver framework. Sliver is an “…open source, cross-platform adversary simulation/red team platform…” written in Golang that supports command and control mechanisms over a variety of protocols including Mutual-TLS (T1573.002), HTTP/S (T1071.001) and DNS (T1071.004). The use of the Sliver framework was likely an attempt to ensure access to a number of the existing WellMess and WellMail victims was maintained following the exposure of those capabilities. As observed with the SolarWinds incidents, SVR operators often used separate command and control infrastructure for each victim of Sliver. SVR actors have used methods other than malware to maintain persistence on high value targets, including the use of stolen credentials.SVR actors often target administrator mailboxes in order to acquire further network information and access. This is likely in an effort to better understand the target network and obtain further privileges or credentials for persistence and/or lateral movement. In one example identified by the NCSC, the actor had searched for authentication credentials in mailboxes, including passwords and PKI keys (T1552). In another incident, the actor leveraged access gained from the SolarWinds campaign to compromise a certificate (T1552.004) issued by Mimecast. The actor used that access to authenticate a subset of Mimecast’s products with customer systems (T1199). In this way, the actor was able to abuse the Mimecast Azure app in order to compromise the final target. The Mimecast Azure application's default application permissions allowed the application full access to all mailboxes in the victim organisation's tenant. Once the actor had gained access to this application, they were able to utilise the applications permissions in order to extract emails from any mailbox used by the victim organisation (T1114.002). For reference, the default permissions that were granted to the Mimecast application can be seen below, along with a definition of the permission: As a result, no further privilege escalation or lateral movement was needed by the actor to access emails of interest.Mandiant FireEye has detailed a number of detection and mitigation strategies that will help organisations proactively harden Microsoft O365 environments against these techniques. This includes recommendations on how to detect suspicious modifications in a user’s O365 mailbox permissions. The SVR targets organisations that align with Russian foreign intelligence interests, including governmental, think-tank, policy and energy targets, as well as more time bound targeting, for example COVID-19 vaccine targeting in 2020. Organisations are advised to follow the mitigation advice and guidance below, as well as the detection rules in the appendix to help protect against this activity. Organisations should also follow the advice and guidance in the recently published joint NSA/CISA/FBI advisory and the subsequent joint FBI/DHS/CISA report, which detail further TTPs linked to SVR cyber actors. Reporting to the NCSC UK organisations affected by the activity outlined in should report any suspected compromises to the NCSC via the website.Volexity has worked three major incidents involving the Dark Halo threat actor. In most cases, the actor aimed to live off the land, primarily focusing on weekly operations to extract e-mail messages from the organization. Dark Halo did use malware and red-teaming tools but largely only for specific one-time tasks as a fallback mechanism when other avenues of access were cut off. For the purposes of this write-up, Volexity will share novel and useful information from the second and third incidents. The second incident involved a sophisticated way to obtain unauthorized access to an account via OWA that had MFA protection in place. The third incident involved a breach by way of the SolarWinds Orion platform.Toward the end of the second incident that Volexity worked involving Dark Halo, the actor was observed accessing the e-mail account of a user via OWA. This was unexpected for a few reasons, not least of which was the targeted mailbox was protected by MFA. Logs from the Exchange server showed that the attacker provided username and password authentication like normal but were not challenged for a second factor through Duo. The logs from the Duo authentication server further showed that no attempts had been made to log into the account in question. Volexity was able to confirm that session hijacking was not involved and, through a memory dump of the OWA server, could also confirm that the attacker had presented cookie tied to a Duo MFA session named duo-sid. Volexity's investigation into this incident determined the attacker had accessed the Duo integration secret key (akey) from the OWA server. This key then allowed the attacker to derive a pre-computed value to be set in the duo-sid cookie. After successful password authentication, the server evaluated the duo-sid cookie and determined it to be valid. This allowed the attacker with knowledge of a user account and password to then completely bypass the MFA set on the account. It should be noted this is not a vulnerability with the MFA provider and underscores the need to ensure that all secrets associated with key integrations, such as those with an MFA provider, should be changed following a breach. Further, it is important that not only are passwords changed after a breach, but that passwords are not set to something similar to the previous password (e.g., Summer2020! versus Spring2020! or SillyGoo$e3 versus SillyGoo$e2).In the third incident, which took place in July 2020, Volexity identified suspicious administrative commands and ActiveSync anomalies in the organization's Exchange environment. Further review of the organization's endpoint software and network traffic confirmed a breach. The attacker had executed commands to export e-mail for specific users in the organization, and then exfiltrated the data via the organization's Outlook Web Anywhere (OWA) server. Many of the technical details regarding the malware used are covered in the FireEye notification. However, in this blog, Volexity can share examples of command-line actions the attacker took after gaining access to the target network and provide insight into additional tools, infrastructure, and attacker objectives.The attacker was quite adept with Exchange and immediately listed various organization configuration settings via PowerShell. Below are a few of the operations that the attacker executed.The attacker also made use of a file called sqlceip.exe, which upon first glance might appear as the legitimate version of SQL Server Telemetry Client provided by Microsoft. However, Volexity determined this tool was actually a version of AdFind from joeware.net. AdFind is a command-line tool used for querying and extracting data from Active Directory. During the course of its investigations, Volexity discovered the attacker using AdFind with the following command line:The attacker used PowerShell to create new tasks on remote machines:They also attempted this on a number of machines using schtasks.exe directly. For example:The attacker exfiltrated e-mail data from targeted accounts using the New-MailboxExportRequest command followed by Get-MailboxExport-Request command. In this case, the attacker was only interested in mail received this year.The attacker created password-protected archives on the victims' OWA server so that they could be exfiltrated via a simple HTTP request.An example URL for the attacker to collect the exfiltrated data would be:On disk, this was located at the following path:Volexity also saw the attacker stage other exfiltration in another folder on the server located here:Finally, the attacker added their own devices as allowed IDs for active sync for a number of mailboxes using Set-CASMailbox:After successfully exporting mail they wished to steal, the attacker would remove the evidence of the export request using Remove-MailboxExportRequest:During the July 2020 incident, Volexity observed at least two indicators that overlapped with indicators of compromise posted by FireEye. The organization's SolarWinds server conducted DGA-style DNS queries under the following subdomain:The vast majority of queries were met with SERVFAIL responses. In most other cases, the hostnames resolved to IPs that fell in the ranges 184.72.0.0/16, 20.141.48.0/24, 8.18.144.0/24, and 8.18.145.0/24. However, the critical responses to the organization came by way of CNAME responses that occurred between June 30, 2020, and July 16, 2020. These DNS resolutions returned a CNAME for the domain freescanonline[.]com. In late July, the attacker took advantage of their access and started moving laterally throughout the organization, which will be described a bit later. Most notably the attacker pushed malware to other systems that beaconed back to the following additional infrastructure:At the time of the incident (July 2020), the attacker had accidentally configured their servers to be open to the Internet, accepting arbitrary requests on port 80. Since then, the attacker has fixed this issue; however, at the time, Volexity was able to identify a number of C2 addresses based on server profiling. Specifically, at the time there were only a handful of servers that responded with the following HTTP headers in the following order:Notably, some of these domains were set up prior to the earlier known compromise date published by FireEye, such as solartrackingsystem[.]net, which was assigned its current nameserver in January 2020. Several of the domains also have very long registration histories going back several years. Volexity believes that attacker obtained these domains through auctions or from registrants after they expired but before they were deleted. This allowed the attacker to use domains with a long history and avoid being detected based on detections tied to a domain being newly registered.At the time of the investigation, Volexity deduced that the likely infection was the result of the SolarWinds box on the target network; however, it was not fully understood exactly how the breach occurred (i.e., whether there was some unknown exploit in play, or other means of access), therefore Volexity was not in a position to report the circumstances surrounding the breach to SolarWinds. The machines involved in this incident had been rebooted several times prior to Volexity's involvement in incident response efforts, meaning that a great deal of evidence that would have been in volatile memory had been lost. Volexity believes that Dark Halo is a sophisticated threat actor based on the following characteristics of their attacks: