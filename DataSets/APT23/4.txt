Taiwan and the Philippines have become the targets of an ongoing campaign called “Operation Tropic Trooper.” Active since 2012, the attackers behind the campaign have set their sights on the Taiwanese government as well as a number of companies in the heavy industry. The same campaign has also targeted key Philippine military agencies. Though the motivations behind the operation are still unclear, the tools and tactics used reveal potential areas of weakness both countries should look into. Operation Tropic Trooper took advantage of two of the most-exploited Windows® vulnerabilities to date— CVE-2010-3333 and CVE-2012-0158—to infiltrate their chosen networks. Part of its success could be attributed to the use of basic steganography or image file attachments laced with malicious code, combined with clever social engineering. This research paper provides in-depth technical information on Operation Tropic Trooper’s targets, components, tools, and tactics.Malware used in Operation Tropic Trooper shared similar characteristics with those used in attacks targeting various organizations in Vietnam and India as early as 2011. [1] Operation Tropic Trooper targets government institutions, military agencies, and companies in the heavy industry in Taiwan and the Philippines. The actors behind Operation Tropic Trooper used spearphishing emails with weaponized attachments to exploit old vulnerabilities, particularly CVE2010-3333 and CVE-2012- 0158. [3–5] These bugs have been two of the most exploited vulnerabilities since their discovery. [6–7] To infiltrate target networks, the attackers relied on crafty social engineering tricks. They used contextually relevant subjects, content, and aptly named attachments such as “Statement” to convince chosen recipients to download and open the files supposedly sent for review.Opening the attachment runs an embedded malicious executable file, normally a downloader that accesses a malicious site to download an image file. Some attachments open decoy documents to hide their malicious nature. The downloader typically attached to emails related to Operation Tropic Trooper is detected by Trend Micro as TROJ_YAHOYAH, a downloader with 32- and 64- bit support. It has an encrypted configuration file and uses HTTP GET requests to download other files that are then decrypted and executed in memory.When executed, TROJ_YAHOYAH checks if the infected system’s Windows OS is 64-bit capable or not. If it is, the Trojan will decrypt a 64-bit copy of itself using a simple XOR cipher with a single-byte key at “0x90.” If the infected system is not 64-bit capable, the Trojan will just drop a 32-bit executable copy of itself (%APP DATA%\Microsoft\ Credentials\Credentials. exe, detected as TROJ_YAHOYAH), along with an encrypted configuration file (%APP DATA%\ Microsoft\Credentials\ Credentials.dat). The configuration file was encrypted using the same simple algorithm featured in the previously cited Rapid7 report on KeyBoy. Unlike the KeyBoy Trojan though, which searches for the string, “IJUDHSDJFKJDE,” TROJ_YAHOYAH searches for “MDDEFGEGETGIZ.” These strings, found at the beginning of the decrypted code, represent the configuration file. Absence of the said file terminates the infection process.TROJ_YAHOYAH’s configuration file, when decrypted, contains the links to sites from which it can download the files it needs to continue its routines. After decryption, it executes a dropped copy using the -Embedding parameter then attempts to delete itself. The downloader’s name was inspired by its selfdeletion routine after dropping its payload. YAHOYAH was derived from the Visayan term “hayohay,” which loosely translates to an easily discarded “servant” in English. TROJ_YAHOYAH attempts to access links and download files via HTTP GET requests. To move to another attack phase, it uses the following user-agent strings:The image is supposed to be an 800 x 600 wallpaper that is way heavier than the real one named “Wind. jpg” normally found in Windows XP systems’ %WINDOWS%\wallpaper\web folder. The actors behind Operation Tropic Trooper may be using a simple steganography technique to mask the backdoor’s routines in order to evade antimalware and network perimeter detection. [9] We have seen the actors use other images found in the same folder such as “Ascent.jpg,” “Friend.jpg,” and “Home.jpg.” A more in-depth analysis of the downloaded file reveals that malicious code has been appended to it. This allows TROJ_YAHOYAH to check offset 0x0F bytes from the end of the file code to identify a marker where the malicious binary code will be added, thus increasing the file’s size. TROJ_YAHOYAH looks for the string, “EHAGBPSL,” and decrypts the appended binary code. When decrypted, an .EXE file is executed in memory. It automatically runs if the user has administrator privileges. If the user has limited privileges though, it will first attempt to obtain administrator privileges by bypassing User Account Control (UAC) but only on Windows 7. It will then decrypt another XOR-encrypted file using the key “0x90” in memory then check if the “StartWork” function was exported then execute it.The last file that TROJ_YAHOYAH executes in memory is the main installer. It contains two more files that install a .DLL file detected as TROJ_YAHAMAM. This file is registered as a service named “INCS” to maintain persistence. It also drops the following XORencrypted malware-laced image files:BKDR_YAHAMAM is usually encrypted then embedded in an image file. When decrypted, it is loaded and executed in memory by a .DLL file that is registered as a service (TROJ_YAHAMAM). It exfiltrates data from infected systems, downloads and uploads files, and has a remote shell. It also drops a rootkit component named “usb.sys,” detected as RTKT_HIDEPORT.ZTCA-XO. The rootkit creates the service, usb30, and hides evidence of port communication to evade detection and remain persistent.BKDR_YAHAMAM encrypts C&C communication using multiplication with a 1-byte key. Attackers can use the “?” and “Help” commands to see the various options the backdoor offers as shown in its code.We were able to download some files from two of the C&C servers that TROJ_YAHAMAM accesses. These had some image files that the 32- and 64-bit versions of the backdoor can choose from for use in attacks.BKDR_YAHAMAM can steal practically any type of file saved on infected systems. Apart from stealing data, it can also perform more harmful actions like kill processes and services, delete files and directories, and put systems to sleep, among others. BKDR_YAHAMAM also attempts to install an accompanying executable rootkit (%windows %\system32\ drivers\usb30.sys, detected as RTKT_HIDEPORT.ZTCA-XO). RTKT_HIDEPORT.ZTCA-XO is also XOR encrypted and found at byte key, “0x90,” to hide the port that the backdoor should use according to the configuration file. It will only hide communication activities occurring in the first of three port entries indicated in the configuration file. After creating and starting the rootkit service, BKDR_YAHAMAM then attempts to delete the rootkit and the related service. This will not stop the rootkit from running in the background. BKDR_YAHAMAM variants with rootkits for 32-bit systems run on 32-bit versions of Windows XP. On Windows 7 64-bit systems, however, the backdoor works but the rootkit does not.In the course of doing research, we also managed to get hold of the following tools that the actors behind Operation Tropic Trooper used in an attack:These hacking tools were possibly remotely downloaded by the attackers onto infected systems. They aided in lateral movement and further intelligence gathering. Data such as credentials saved on infected systems can be stolen via Address Resolution Protocol (ARP) poisoning or main-in-the-middle (MiTM) Layer 2 and passthe-hash attacks. [11–12] The stolen credentials allow attackers laterally move throughout a network. The threat actors no longer have to hack their way in, they have the ability to log in as legitimate users.Based on the specially crafted documents we were able to gather, Operation Tropic Trooper has been active since 2012. We have seen malware samples from 2011 that behaved the same way and used similar file markers. [13] The following table provides more detailed information on Operation Tropic Trooper’s downloader, TROJ_YAHOYAH.Network and system administrators can protect against Operation Tropic Trooper by blocking user access to related C&C servers. They should also keep an eye out for related strings as well as services and their corresponding paths. We also recommend a Custom Defense strategy that uses a comprehensive “Detect—Analyze— Respond” life cycle to address threats particular to an organization. This can provide in-depth threat profile information as well as advanced threat detection at the network level to discover malicious content (malware), communication, and attacker activity that are not typically visible to traditional security solutions.Operation Tropic Trooper is not highly sophisticated. But the fact that it has attained some degree of success and has managed to infiltrate crucial organizations in both Taiwan and the Philippines shows the urgent need for targeted entities to rectify their shortcomings in terms of security. As with other targeted attacks, Operation Tropic Trooper brings great risks, especially since its targets include government institutions and military agencies. Although we were not able to collect enough information to determine the identities and motivations of the actors behind Operation Tropic Trooper, we were able to gather enough intelligence to help potential victims defend against the campaign. Knowing that attackers are still using old techniques and exploiting known vulnerabilities will make it easier for the targeted organizations to pinpoint and fix security gaps in their networks. Building threat intelligence is crucial in the fight against targeted attacks. Identifying the tools, tactics, and procedures (TTPs) that threat actors use based on external reports and internal historical and current monitoring can help create a strong database of indicators of compromise (IoCs) that can serve as basis for action. Using the right tools for advanced threat protection should also be part of an expanded security monitoring strategy. This includes establishing and empowering incident response teams and training employees, partners, and vendors on social engineering and computer security.