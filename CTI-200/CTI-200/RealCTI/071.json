{
    "event_id": "071",
    "claim": "This emulation plan is presented to advance the practice of security testing through adversary emulation, targeting the emulation of the APT3 threat group, covering their known behaviors, tactics, techniques, and procedures, and is grounded in the MITRE ATT&CK model, spanning the adversary lifecycle from initial network compromise to exfiltration.",
    "original_label": "true",
    "label": "true",
    "explain": "To advance the practice of security testing through adversary emulation, we present this emulation plan to be used by a team looking to emulate the APT3 threat group. It includes their commonly known behavior through the tactics, techniques, and procedures that have been documented in publicly available reporting. To ground the plan in a common taxonomy, it is based on the MITRE ATT&CK model. The scope covers the adversary lifecycle, from initial network compromise through exfiltration. It discusses tools, methods, style, tradecraft, and end-goals. To fill intel gaps, best-estimates based on experience in threat intelligence and adversary emulation are provided. We would like to acknowledge the people that contributed to the content, review, and format of this document. This includes: Frank Duff, Katie Nickels, and Blake Strom. In an effort to advance the practice of security testing through adversary emulation and adversarial engineering, we present this emulation plan to be used by an adversary emulation team looking to emulate the threat group commonly known as APT3. The plan includes the group’s commonly known behavior through the tactics, techniques, and procedures (TTPs) that have been documented in publicly available threat reporting. To ground the plan in a common taxonomy, it is based on the MITRE ATT&CK model1 . The scope of this emulation plan covers the adversary lifecycle, beginning with initial network compromise and ending with exfiltration. It discusses tools, methods, style, tradecraft, and end state objectives. Historically, information about attackers’ on-target actions and goals have been difficult to obtain and APT3 reporting is no exception; however, the document bases instructions off publicly accessible sources whenever possible, focusing on sources that could be cross-referenced to some degree. To fill the intel gaps, the authors relied on their experience in threat intelligence and adversary emulation for best-estimates. Threat reporting sources vary widely, and correlation of activity to a threat group is not straightforward, and as such the authors have worked to ensure reputable sources are referenced. While many threat intelligence sources work to provide information that is as accurate as possible to the community, there is still an inherent risk that third-party threat reporting may provide inaccurate information. Note: Within this document, italicized text represents notes. These notes represent comments that are not supported by evidence but represent the author’s opinion. For example, they discuss concessions that have been made to make the emulation instructions practical or to indicate where inconsistent or nonexistent reporting has required gaps to be filled in with best-guess estimates of adversary behavior. References are indicated in-line with bracketed numbers [#] and listed at the end of this document.Adversary Objectives: Reporting indicates APT3 actors are interested in exfiltration of documents [3]. They have been known to target printers and file shares [3]. They also target intellectual property, often industrial in nature. [4]. Background: APT3 is a China-based threat group. APT3 has traditionally targeted a myriad of US and international targets; however, reporting dated September 2016 indicates the group shifted focus around March 2016 to target Hong Kong organizations [3].These phases are broken up into more detail in the following sections. The next section is about the tools that APT3 uses for their operations, how to emulate them, and what ATT&CK tactics and techniques they correspond to. Command-line examples, as well as descriptions of what the tools do, are included in the accompanying “APT3 Adversary Emulation Field Manual” for reference.APT3 uses a combination of custom and openly available tools. Because custom adversary tools can have hidden functionality, be difficult to tailor to new environments, or utilize server-side controllers which may be unavailable, recommendations are made for replacements that can accurately perform similar activity. Adversary emulators and defenders should be aware that replacement tools will typically leave different footprints than adversary tools, specifically different file hashes, command line arguments, Antivirus detection, API calls, and network signatures. There are lots of ways to accomplish the same objectives with built-in Windows tools, but the focus for APT3 tends to be on more simplistic tools rather than more advanced Windows utilities like WMIC, WinRM, and PowerShell. The following table describes how to emulate the tools as well as detailing which ATT&CK Tactics are represented by them. APT3’s custom tools provide a breadth of functionality. This section aims to break down these custom tools from the table above a bit further into their specific functions and show how they relate to ATT&CK, Windows utilities, and toolkits that are open source and commercially available. Note: The PlugX table differs from the other tables in that each row refers to a module, not function, of PlugX. Modules within PlugX leverage other PlugX modules to perform functions, for example, the Disk module allows other modules to use any of the functions it provides on the disk, such as execute, create new files, copy, delete, etc..APT3 disseminates spam-like phishing campaigns with various payload delivery methods [1]. Once on a machine, the actors collect information about the victim such as connected users [14] and analyze it for its value, trying to determine where they landed and what access they have. Admin access is an obvious main target due to the increased access it will likely provide. The actors then drop multiple backdoors, usually 2-4 on the initial system and 5+ versions within the first few hops, with independent C2 profiles for redundancy [Redundant Access – T1108]. Next they then dump as many credentials as possible, and quickly continue spreading throughout the network. They specifically go after file servers and print servers [1] [3]. Once they’re moved to all the machines they think have value, they collect all the documents they want, package them up and password protect them, and exfiltrate them out of the organization [15]. In some cases, however, they’ve been known to persist within a network for very lengthy periods without ever exfiltrating data. The sections below show how APT3 acts through their entire lifecycle. Phase 1 documents what happens during initial compromise, phase 2 highlights techniques used during network propagation, and phase 3 documents one way they have been known to perform exfiltration. The goal of the Initial Compromise phase is to achieve successful code execution and control of a system within the target environment. APT3 primarily conducts initial compromise using spear phishing, delivering implants through both malicious attachments and malicious links. They have used new 0-days on multiple browsers [15]. They have targeted existing 0-days in Internet Explorer [2], Windows [2], and Flash [14]. They have also been known to compromise weakly secured legitimate websites to which users are directed through spear phishing emails [16]. APT3 implants issue command and control (C2) traffic as HTTP GET requests that beacon at set intervals [14]. The HTTP Cookie field contains information for the C2 server, which responds with a webpage that contains the command encoded within a specific HTML tag [15]. APT3 implants have also been known to use custom binary protocols [2]. Pirpi.2014 and Pirpi.2015 both contain several kinds of sleep and anti-sandbox strategies that cause the RAT to pause between executions [15]. Some of the Pirpi instances have been known to also use SSL for their communications and even include public/private keys within the binaries [17]. This level of C2 customization can be achieved with Cobalt Strike’s malleable C2 profiles, as seen in the accompanying Malleable C2 profile modeled on [14].Many of APT3’s open source tools are customized or modified to prevent detection. Additionally, APT3’s malware uses a series of anti-disassembly techniques [3], including requiring certain command line parameters to run [17]. These are defense evasion techniques that APT3 sets up before getting initial access to the target environment. It is recommended to use anti-antivirus (AV) capabilities to prevent AV detection of commonly available tools. If Sandboxing is a problem, possibly encrypt tools to bypass sandboxing. An example of this would be Veil-Evasion [18] or Artifact Kit [19]. ATTACK techniques: T1027 – Obfuscated Files or Information, T1045 – Software Packing, T1066 – Indicator Removal from Tools.For Initial Compromise, both web server drive-by and malicious attachments are within APT3’s tradecraft. The Social Engineering Toolkit (free) [20] and Cobalt Strike (paid) [6] have features that support these methods. In late November 2014 an APT3 campaign used a spear phishing email (see Appendix A) containing a link to a malicious site. The site contained JavaScript that triggered CVE-2014-6332 (an Internet Explorer exploit [21]) which launched a VBscript and PowerShell based payload. The PowerShell script in turn downloaded and ran a stager which dropped two files, “doc.exe” and “test.exe”. “doc.exe” attempts to trigger CVE-2014-4113 (a Windows Kernel exploit [22]) and run “test.exe” with the resultant elevated privileges. “test.exe” runs two commands: In late November 2014 an APT3 campaign used a spear phishing email (see Appendix A) containing a link to a malicious site. The site contained JavaScript that triggered CVE-2014-6332 (an Internet Explorer exploit [21]) which launched a VBscript and PowerShell based payload. The PowerShell script in turn downloaded and ran a stager which dropped two files, “doc.exe” and “test.exe”. “doc.exe” attempts to trigger CVE-2014-4113 (a Windows Kernel exploit [22]) and run “test.exe” with the resultant elevated privileges. “test.exe” runs two commands: In attacks reported in June 2014, APT3 actors sent a RAR archive as an email attachment. It contained a resume and program purported to be written by the job candidate. The program, ttcalc.exe, contained a legitimate version of TTCalc but also dropped Pirpi to:Reported in June 2014, APT3 actors sent an encrypted self-extracting RAR attachment. The RAR contained a trojanized setup program which attempts to drop and run ttcalcBAK.exe another self-extracting RAR which drops a DLL version of the PlugX RAT at: Reported in 2015, two different APT3 campaigns targeted Flash exploits, CVE-2014-1776 and CVE-2015-3113. In both cases the Flash exploit loaded the payload (the Pirpi RAT) from specially crafted GIF images. Reported in July 2015, APT3 used spear phising to direct targets to a compromised site. This site had ScanBox installed which was used to profile the victims and in some cases, deliver exploits to selected victims.The goal of the Network Propagation phase is to identify and move to desired systems within the target environment with the intention of discovering credentials and documents for exfiltration. Publicly reported direct observation of APT3’s Network Propagation techniques is almost non-existent. One report that discusses general characteristics of APT3 is [23], but it is uncertain what data sources were used to compile the listed TTPs. Aside from that report we draw conclusions of how APT3 operates based on the capabilities of Pirpi and other tools that they are reported to use. There are some persistence techniques that they have used during Initial Compromise that can be applied to Network Propagation. Despite this, there are significant gaps in the public knowledge of APT3’s tradecraft. Where necessary we fill in details with best guesses or recommendations. The process within this phase can be described with the below diagram. Each step within this phase is broken out by ATT&CK tactic and the corresponding APT3 specific techniques documented in reports. A command-line reference for emulating the specific ATT&CK techniques with built-in Windows utilities, Cobalt Strike, and Metasploit can be found in the accompanying “APT3 Adversary Emulation Field Manual”. APT3 can perform discovery with its OSInfo tool and by running built-in Windows utilities on the command-line using cmd.exe. Based on the commands available in APT3’s toolset, there is a lot of time spent enumerating domain groups with elevated permissions like “Domain Admins”, “Enterprise Admins”, and “Power Users” [T1069 - Permission Groups Discovery]. There’s also a heavy emphasis on enumerating users in these special groups with the “net user” command [T1087 – Account Discovery]. Credential dumping and persistence may require local privilege escalation if the attacker does not have control of a high integrity process; however, the only reporting available on local privilege escalation methods used by APT3 is CVE-2014-4113 [2]. It is possible that their strong reliance on credential access (detailed later) allows them to use credentials with increasing levels of access in place of other local privilege escalation mechanisms. Their perceived focus during this phase, however, is on finding credentials that allow direct admin permissions. In this case, control falls through to credential access or persistence. During an engagement, adversary emulators may find it necessary to perform local privilege escalation due to time constraints. Most common frameworks (including Metasploit and Cobalt Strike) contain some methods for privilege escalation. Also, UACBypass [24] and PowerUp [9] are common and freely available tools that may be used to perform Privilege Escalation. APT3 has used multiple methods for persistence: creating a service [23] (T1050 - New Service), creating a scheduled task [2] (T1053 - Scheduled Task), and also by placing scripts in the Startup Folder [7] [T1060 - Registry Run Keys/Start Folder]. APT3 has replaced the Sticky Keys binary (C:\\Windows\\System32\\sethc.exe) with cmd.exe [T1015 - Accessibility Features] and enabled Remote Desktop Protocol (RDP) if it is not already enabled [T1076 – Remote Desktop Protocol]. This specific Persistence technique has an added benefit of allowing an operator to open a command prompt when connected over RDP without having to provide valid credentials [23]. APT3 has been known to create or enable accounts, for example “support_388945a0”, and add them to the local admin group [23] [T1136 – Create Account]. Presumably this is done for easier future access. Recommendation: On new hosts, establish persistence by creating a service or schtasks. On systems where RDP capabilities are desired, it might also be useful to enable sticky keys and RDP. APT3 uses many forms of credential access. They used customized versions of pwdump, and later a custom compiled version of mimikatz, to search for cached Windows credentials [T1003 - Credential Dumping] as well as ChromePass and Lazagne [(T1081 - Credentials in Files], to search though browser and other credential caches. Their pwdump tool injects itself into lsass.exe and is executed by running the GetHash export of the lsremora.dll [3] Mimikatz is used to dump plaintext credentials by injecting into lsass.exe. [T1003 - Credential Dumping]. They also install a keylogger, which can be used to discover credentials and remote systems [T1056 - Input Capture]. This keylogger installs itself as a service and records keystrokes in encrypted files such as thumbcache_96.dbx [T1027 – Obfuscated Files or Information] [3]. Though publicly reported information on how APT3 enumerates machines aside from related commands in APT3’s tools, they’ve been known to use “net view” and dsquery to do so. This may be due to a lack of available information on how APT3 operates during an operation since most reports tend to be focused on forensic information. Pirpi has commands that list servers in the domain, list TCP connections and retrieve connected users (T1049 - Network Connections Discovery), and list Domain Controllers (T1018 - Remote System Discovery). Some of this information may be used to identify target hosts for lateral movement. In addition to built-in Windows utilities, there are some open source tools which collect similar information. APT3 will quickly spread to other machines as fast as possible, often checking for easy password reuse by trying to mount shares from other machines via “net use” [T1078 – Valid Accounts] [T1077 - Windows Admin Shares] [T1110 – Brute Force]. APT3 uses a custom tool called RemoteCMD that can run commands on a remote system. It’s not clear what protocol(s) are being used, but RemoteCMD supports file operations (upload, download, delete and rename) service operations (creation, deletion, start and stop) and scheduled tasks (AT,schtasks). Presumably these are done over SMB (files), Remote Service (services) and Remote Schtasks (AT). It’s likely that APT3 will compromise a network to a certain degree of satisfaction before starting to exfil, due to stealth concerns. Depending on the defensive setup, exfiltration could be much noisier and noticeable than attempting to hide in the noise with lay-of-the-land tools. The only source we were able to find for APT3 exfiltration methods is from 2012. For exfiltration, they will identify Office documents on the computer [23] [T1005 - Data from Local System]. They then drop the command-line Chinese language version of WinRAR and use it to compress and encrypt the discovered documents [T1002 - Data Compressed]. This archive will then be stored in the recycle bin [23], usually on a machine designated as a staging server, which they move the exfiltration through [T1074 - Data Staged]. Data is exfiltrated over port 443 which is typically HTTPS traffic, however they have used SSL encryption [17] and normal HTTP [23] [T1043 - Commonly Used Port].\n\n\n",
    "reports": [
        {
            "link": "https://www.symantec.com/blogs/threat-intelligence/buckeye-windows-zero-day-exploit/",
            "content": "APT3 was one of the biggest APT threats to Western companies, yet it was completely silenced by shining a light on its activities and exposing the identities of those behind the group to the world. APT3 was, at the time, one of the most damaging APT attacks to hit Western companies. Our analysis formed the basis of articles by, among others, Security Week, Dark Reading, Recorded Future, Threat Post and Security Lab. The Information Security community agreed with our conclusion that Boyusec and MSS were behind the APT3 attacks. This blog has been contacted by several InfoSec professionals who had been following APT3. Twelve months have passed since this blog exposed Wu Yingzhuo, Dong Hao, their company ‘Boyusec’ and the Chinese Ministry of State Security (MSS) as being behind APT3.",
            "domain": "www.symantec.com",
            "tokenized": [
                {
                    "sent": "APT3 was one of the biggest APT threats to Western companies, yet it was completely silenced by shining a light on its activities and exposing the identities of those behind the group to the world.",
                    "is_evidence": 0,
                    "is_repeat": 0
                },
                {
                    "sent": "APT3 was, at the time, one of the most damaging APT attacks to hit Western companies.",
                    "is_evidence": 0
                },
                {
                    "sent": "Our analysis formed the basis of articles by, among others, Security Week, Dark Reading, Recorded Future, Threat Post and Security Lab.",
                    "is_evidence": 0
                },
                {
                    "sent": "The Information Security community agreed with our conclusion that Boyusec and MSS were behind the APT3 attacks.",
                    "is_evidence": 0
                },
                {
                    "sent": "This blog has been contacted by several InfoSec professionals who had been following APT3.",
                    "is_evidence": 0
                },
                {
                    "sent": "Twelve months have passed since this blog exposed Wu Yingzhuo, Dong Hao, their company ‘Boyusec’ and the Chinese Ministry of State Security (MSS) as being behind APT3.",
                    "is_evidence": 0
                }
            ]
        },
        {
            "link": "https://www.mandiant.com/resources/blog/operation-clandestine-wolf-adobe-flash-zero-day/",
            "content": "APT3 (also known as UPS, Gothic Panda, and TG-011) is a sophisticated threat group that has been active since at least 2010. APT3 utilizes a broad range of tools and techniques including spearphishing attacks, zero-day exploits, and numerous unique and publicly available remote access tools (RAT). Boyusec stated that the mission of the joint lab was to develop risk-based security technology and to provide users with innovative network defense capabilities. Recorded Future has been closely following APT3 and has discovered additional information corroborating that the MSS is responsible for the intrusion activity conducted by the group. The translated text is, “In 2014, Guangzhou Boyu Information Technology Company and Guangdong ITSEC cooperated closely to establish a joint active defense lab (ADUL).”The lifecycle of APT3 is emblematic of how the MSS conducts operations in both the human and cyber domains. This is the first time researchers have been able to attribute a threat actor group with a high degree of confidence to the Ministry of State Security.",
            "domain": "www.mandiant.com",
            "tokenized": [
                {
                    "sent": "APT3 (also known as UPS, Gothic Panda, and TG-011) is a sophisticated threat group that has been active since at least 2010.",
                    "is_evidence": 0,
                    "is_repeat": 0
                },
                {
                    "sent": "APT3 utilizes a broad range of tools and techniques including spearphishing attacks, zero-day exploits, and numerous unique and publicly available remote access tools (RAT).",
                    "is_evidence": 0
                },
                {
                    "sent": "Boyusec stated that the mission of the joint lab was to develop risk-based security technology and to provide users with innovative network defense capabilities.",
                    "is_evidence": 0,
                    "is_repeat": 0
                },
                {
                    "sent": "Recorded Future has been closely following APT3 and has discovered additional information corroborating that the MSS is responsible for the intrusion activity conducted by the group.",
                    "is_evidence": 0,
                    "is_repeat": 0
                },
                {
                    "sent": "The translated text is, “In 2014, Guangzhou Boyu Information Technology Company and Guangdong ITSEC cooperated closely to establish a joint active defense lab (ADUL).”The lifecycle of APT3 is emblematic of how the MSS conducts operations in both the human and cyber domains.",
                    "is_evidence": 0
                },
                {
                    "sent": "This is the first time researchers have been able to attribute a threat actor group with a high degree of confidence to the Ministry of State Security.",
                    "is_evidence": 0,
                    "is_repeat": 0
                }
            ]
        },
        {
            "link": "https://www.recordedfuture.com/blog/chinese-mss-behind-apt3/",
            "content": "Execution Prevention (DEP). In June, FireEye’s FireEye as a Service team in Singapore uncovered a phishing campaign exploiting an Adobe Flash Player zero-day vulnerability (CVE-2015-3113). In the last several weeks, APT3 actors launched a large-scale phishing campaign against organizations in the following industries:Upon clicking the URLs provided in the phishing emails, targets were redirected to a compromised server hosting JavaScript profiling scripts. The attackers use a ROP chain to call kernel32!VirtualAlloc to mark their shellcode as executable before jumping to their shellcode. The attackers’ emails included links to compromised web servers that served either benign content or a malicious Adobe Flash Player file that exploits CVE-2015-3113. The phishing emails used by APT3 during this campaign were extremely generic in nature, almost appearing to be spam.",
            "domain": "www.recordedfuture.com",
            "tokenized": [
                {
                    "sent": "Execution Prevention (DEP).",
                    "is_evidence": 0,
                    "is_repeat": 0
                },
                {
                    "sent": "In June, FireEye’s FireEye as a Service team in Singapore uncovered a phishing campaign exploiting an Adobe Flash Player zero-day vulnerability (CVE-2015-3113).",
                    "is_evidence": 0
                },
                {
                    "sent": "In the last several weeks, APT3 actors launched a large-scale phishing campaign against organizations in the following industries:Upon clicking the URLs provided in the phishing emails, targets were redirected to a compromised server hosting JavaScript profiling scripts.",
                    "is_evidence": 0
                },
                {
                    "sent": "The attackers use a ROP chain to call kernel32!VirtualAlloc to mark their shellcode as executable before jumping to their shellcode.",
                    "is_evidence": 0
                },
                {
                    "sent": "The attackers’ emails included links to compromised web servers that served either benign content or a malicious Adobe Flash Player file that exploits CVE-2015-3113.",
                    "is_evidence": 0
                },
                {
                    "sent": "The phishing emails used by APT3 during this campaign were extremely generic in nature, almost appearing to be spam.",
                    "is_evidence": 0
                }
            ]
        },
        {
            "link": "https://intrusiontruth.wordpress.com/2018/05/22/the-destruction-of-apt3/",
            "content": "Based on the timing of the attacks and the features of the tools and how they are constructed, one possibility is that Buckeye may have engineered its own version of the tools from artefacts found in captured network traffic, possibly from observing an Equation Group attack. CVE-2017-0143 was also used by two other exploit tools—EternalRomance and EternalSynergy—that were released as part of the Shadow Brokers leak in April 2017. However, Symantec has now found evidence that the Buckeye cyber espionage group (aka APT3, Gothic Panda) began using Equation Group tools in attacks at least a year prior to the Shadow Brokers leak. In order to obtain remote code execution capabilities, all three exploit tools needed to collect information about the memory layout of attacked systems in addition to exploiting the aforementioned message type confusion vulnerability. In the case of the Buckeye exploit tool, the attackers exploited their own zero-day vulnerability (CVE-2019-0703). The 2017 leak of Equation Group tools by a mysterious group calling itself the Shadow Brokers was one of the most significant cyber security stories in recent years.",
            "domain": "intrusiontruth.wordpress.com",
            "tokenized": [
                {
                    "sent": "Based on the timing of the attacks and the features of the tools and how they are constructed, one possibility is that Buckeye may have engineered its own version of the tools from artefacts found in captured network traffic, possibly from observing an Equation Group attack.",
                    "is_evidence": 0,
                    "is_repeat": 0
                },
                {
                    "sent": "CVE-2017-0143 was also used by two other exploit tools—EternalRomance and EternalSynergy—that were released as part of the Shadow Brokers leak in April 2017.",
                    "is_evidence": 0
                },
                {
                    "sent": "However, Symantec has now found evidence that the Buckeye cyber espionage group (aka APT3, Gothic Panda) began using Equation Group tools in attacks at least a year prior to the Shadow Brokers leak.",
                    "is_evidence": 0
                },
                {
                    "sent": "In order to obtain remote code execution capabilities, all three exploit tools needed to collect information about the memory layout of attacked systems in addition to exploiting the aforementioned message type confusion vulnerability.",
                    "is_evidence": 0,
                    "is_repeat": 0
                },
                {
                    "sent": "In the case of the Buckeye exploit tool, the attackers exploited their own zero-day vulnerability (CVE-2019-0703).",
                    "is_evidence": 0
                },
                {
                    "sent": "The 2017 leak of Equation Group tools by a mysterious group calling itself the Shadow Brokers was one of the most significant cyber security stories in recent years.",
                    "is_evidence": 0
                }
            ]
        }
    ]
}