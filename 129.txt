{
  "event_id": "129",
  "claim": "We identified several instances of their low-volume targeted attack campaigns launched against our customers in the UK and Europe region.",
  "original_label": "true",
  "label": "true",
  "explain": "Since the beginning of 2022, ThreatLabz has been closely monitoring the activities of the Evilnum APT group. We identified several instances of their low-volume targeted attack campaigns launched against our customers in the UK and Europe region. The new instances of the campaign use updated tactics, techniques, and procedures. In earlier campaigns observed in 2021, the main distribution vector used by this threat group was Windows Shortcut files (LNK) sent inside malicious archive files (ZIP) as email attachments in spear phishing emails to the victims. In the most recent instances, the threat actor has started using MS Office Word documents, leveraging document template injection to deliver the malicious payload to the victims’ machines. In this blog, we present the technical details of all components involved in the end-to-end attack chain. At the time of writing, to the best of our knowledge, the complete attack chain of this new instance of Evilnum APT group is not publicly documented anywhere. ThreatLabz has identified several domains associated with Evilnum APT group which have not been previously detected by security vendors. This discovery indicates that the Evilnum APT group has been successful at flying under the radar and has remained undetected for a long time. The key targets of the Evilnum APT group have predominantly been in the FinTech (Financial services) sector, specifically companies dealing with trading and compliance in the UK and Europe. In March 2022, we observed a significant update in the choice of targets of Evilnum APT group. They targeted an Intergovernmental organization which deals with international migration services. The timeline of the attack and the nature of the chosen target coincided with Russia-Ukraine conflict. Macro-based documents used in the template injection stage leveraged VBA code stomping technique to bypass static analysis and also to deter reverse engineering. A heavily obfuscated JavaScript was used to decrypt and drop the payloads on the endpoint. The JavaScript configured a scheduled task to run the dropped binary. This JavaScript has significant improvements in the obfuscation technique compared to the previous versions used by EvilNum APT group. The names of all the file system artifacts created during the course of execution were chosen carefully by the threat actor to spoof legitimate Windows and other legitimate third party binaries' names. In each new instance of the campaign, the APT group registered multiple domain names using specific keywords related to the industry vertical targeted.For the purpose of technical analysis we will consider the document with MD5: 0b4f0ead0482582f7a98362dbf18c219 . The stage 1 malicious document is delivered via spear phishing email. Once the user downloads and opens the malicious document, it fetches the stage 2 macro template from the attacker-hosted domain and displays the decoy content as shown in Figure 2 asking the user to enable the macro content.The stage 2 template contains the main malicious macro code. It makes use of VBA code stomping technique which is fairly uncommon in the wild. This technique destroys the original source code and only a compiled version of the VBA macro code (also known as p-code) is stored in the document. As a result, this technique prevents static analysis tools such as olevba from extracting the decompiled VBA code. Using the technique mentioned by the Walmart team here, we were able to extract the full macro code. All the strings in the macro code are decrypted using the string decryption function shown in Figure 3.Below are the key functionalities of the macro. 1. The document file has two text boxes with encrypted contents. These textboxes will be decrypted at run time by the VBA macro code. a) Textbox 1 - msform_ct.TextBox1.Text. This will be decrypted and contents will be written to %appdata%\\“ThirdPartyNotices.txt” b) Textbox 2 - msform_ct.TextBox2.Text - This will be decrypted and contents will be written to “%appdata%\\Redist.txt” 2. Copies the legitimate Windows binary Wscript.exe to a file with the name “msdcat.exe”. Such file copy operations are done by malwares as a way to bypass endpoint security products. 3. The file - Redist.txt contains the obfuscated JavaScript which will be executed with the following command line: msdcat.exe /E:jscRipt “%appdata%\\Redist.txt” dg ThirdPartyNotices.txt Note: “dg” is a hard coded command line parameter present inside the VBA macro code. 4. During the course of execution of VBA macro code, there are multiple calls to doc.Shapes.AddPicture() which fetches a JPG image from the attacker-controlled server. We believe this was done by the attacker to trace and log the execution of code on the endpoint. One such example is shown in Figure 4. There is a call to doc.Shapes.AddPicture() between the building of the command line and the execution of the command line.The original JavaScript dropped by the VBA-based macro code is heavily obfuscated. We will highlight some of the unique obfuscation techniques used which are rarely observed in obfuscated JavaScripts. There are two parameters passed to this JavaScript at the time of execution with following command line: msdcat.exe /E:jscRipt “C:\\Users\\user\\AppData\\Roaming\\Redist.txt” dg ThirdPartyNotices.txt parameter 1: “dg”. This string is later used in the string decryption function in JavaScript. parameter 2: The file “ThirdPartyNotices.txt” contains the encrypted code which will be decrypted and dropped by the JavaScript on the filesystem with binary name - SerenadeDACplApp.exe Most obfuscation techniques involve a large array of encrypted and encoded strings which are referenced throughout the code using indexes. A common approach to deobfuscate this requires multiple “search and replace” operations where you replace the reference with the actual decrypted and decoded string. JavaScript in this case used an interesting technique where the original array of strings was shuffled, and would be unshuffled in memory at the time of execution. So, any attempt to dereference the strings without unshuffling the array would result in an error. Such a method can be used to deter reverse engineering and also bypass some tools which try to automate the process of deobfuscation. Let's look at it in more detail. Figure 5 below shows the huge array of strings defined at the beginning of the JavaScript. This array is wrapped inside a function as an extra layer of obfuscation.The next step is to unshuffle the array. Figure 6 below shows the relevant JavaScript code which uses a brute force approach to unshuffle the array. It has a predefined seed of value “0x6467a”. Upon each iteration, the function computes a seed using various mathematical operations and compares it with the predefined seed “0x6467a”. The function continues to shift the contents of the array by one position to the right until this condition is satisfied. Relevant comments are included in the code to illustrate the unshuffling logic.Other techniques used for obfuscation involve control flow flattening techniques which leverage switch-case obfuscation. Figure 7 shows one of the string decryption functions which uses such an obfuscation technique.The sequence of steps of decryption are shuffled using switch-case and the order is followed according to the following sequence: “15|12|3|2|14|5|1|10|9|17|8|7|6|4|13|16|0|11” It means, “case 15” is executed followed by “case 12” and so on. The final “case 11” returns the decrypted string. We can re-write the string decryption function as shown in Figure 8 which is easier to analyze.The threat actor achieves persistence via Scheduled task. During JavaScript execution, a scheduled task with the name “UpdateModel Task'' will be created to execute the dropped loader binary with required command line arguments.Once all the above operations are done. The backdoor selects one of the C2 domains and a path string from the configuration and sends the beacon network request. If the beacon request is successful, the backdoor will query the server for available content and download it. Based on the content size two different operations are performed:\n\n\n",
  "reports": [
    {
      "link": "https://www.welivesecurity.com/2020/07/09/more-evil-deep-look-evilnum-toolset/",
      "content": "ESET has analyzed the operations of Evilnum, the APT group behind the Evilnum malware previously seen in attacks against financial technology companies. Evilnum uses it in conjunction with its homemade backdoors in order to provide redundancy and additional persistence on victim networks. However, we will continue to name the malware Evilnum to avoid creating confusion. In a small number of cases, the Evilnum group has also deployed some tools purchased from a Malware‑as‑a‑Service provider. The malicious components previously mentioned are frequently extended with several additional tools in the Evilnum group’s arsenal. We have named the group Evilnum as that is the name of their flagship malware, and we’ll refer to the various malware pieces as components.",
      "domain": "www.welivesecurity.com",
      "tokenized": [
        {
          "sent":"ESET has analyzed the operations of Evilnum, the APT group behind the Evilnum malware previously seen in attacks against financial technology companies.",
          "is_evidence": 1,
          "is_repeat": 0
        },
        {
          "sent":"Evilnum uses it in conjunction with its homemade backdoors in order to provide redundancy and additional persistence on victim networks.",
          "is_evidence": 0
        },
        {
          "sent": "However, we will continue to name the malware Evilnum to avoid creating confusion.",
          "is_evidence": 0
        },
        {
          "sent": "In a small number of cases, the Evilnum group has also deployed some tools purchased from a Malware‑as‑a‑Service provider.",
          "is_evidence": 0
        },
        {
          "sent":"The malicious components previously mentioned are frequently extended with several additional tools in the Evilnum group’s arsenal.",
          "is_evidence": 0
        },
        {
          "sent":  "We have named the group Evilnum as that is the name of their flagship malware, and we’ll refer to the various malware pieces as components.",
          "is_evidence": 0
        }
      ]
    },
    {
      "link": "https://www.cybereason.com/blog/no-rest-for-the-wicked-evilnum-unleashes-pyvil-rat/",
      "content": "During the infection stage, Evilnum utilized modified versions of legitimate executables in an attempt to stay stealthy and remain undetected by security tools. In the past, Evilnum’s infection chain started with spear phishing emails, delivering zip archives that contain LNK files masquerading as images. In this write-up, we dive into the recent activity of the Evilnum group and explore its new infection chain and tools. The group first emerged in 2018, and since then, Evilnum’s activity has been varied, with recent reports using different components written in Javascript and C# as well as tools bought from the Malware-as-a\u0002Service provider Golden Chickens. The initial infection vector of Evilnum typically begins with spear phishing emails, with the goal of delivering ZIP archives that contain LNK files masquerading as photos of different documents such as driving licenses, credit cards, and utility bills. The resolution address of all domains changed in the span of a few days, with the addition of three new domains:In this write-up, we examined a new infection chain by the Evilnum group - threat actors who have started to make a name for themselves.",
      "domain": "www.cybereason.com",
      "tokenized": [
        {
          "sent": "During the infection stage, Evilnum utilized modified versions of legitimate executables in an attempt to stay stealthy and remain undetected by security tools.",
          "is_evidence": 1,
          "is_repeat": 0
        },
        {
          "sent": "In the past, Evilnum’s infection chain started with spear phishing emails, delivering zip archives that contain LNK files masquerading as images.",
          "is_evidence": 0
        },
        {
          "sent":"In this write-up, we dive into the recent activity of the Evilnum group and explore its new infection chain and tools.",
          "is_evidence": 1,
          "is_repeat": 0
        },
        {
          "sent":"The group first emerged in 2018, and since then, Evilnum’s activity has been varied, with recent reports using different components written in Javascript and C# as well as tools bought from the Malware-as-a\u0002Service provider Golden Chickens.",
          "is_evidence": 1,
          "is_repeat": 0
        },
        {
          "sent":"The initial infection vector of Evilnum typically begins with spear phishing emails, with the goal of delivering ZIP archives that contain LNK files masquerading as photos of different documents such as driving licenses, credit cards, and utility bills.",
          "is_evidence": 0
        },
        {
          "sent":"The resolution address of all domains changed in the span of a few days, with the addition of three new domains:In this write-up, we examined a new infection chain by the Evilnum group - threat actors who have started to make a name for themselves.",
          "is_evidence": 1,
          "is_repeat": 0
        }
      ]
    },
    {
      "link": "https://nsfocusglobal.com/operation-darkcasino-in-depth-analysis-of-attacks-by-apt-group-evilnum-part-1/#:~:text=Evilnum%E2%80%99s%20typical%20attack%20method%20is%20to%20disguise%20malware,abilities%20to%20design%20complicated%20attack%20flows%20and%20components./",
      "content": "Correlation of IoC clues demonstrated that part of Evilnum’s assets could be linked to cyberattack activities targeting cryptocurrency-related trading platforms, which started in the second half of 2021 and continued to early 2022. Evilnum attackers aimed to steal the transaction credentials and related information stored on target hosts. Evilnum’s typical attack method is to disguise malware as the client identity file to trick Fintech staff into running the program. NSFOCUS Security Labs had ever observed and disclosed that Evilnum’s attack flows were launched with a high completion rate and a stub trojan, AgentVX, was used. Recently, NSFOCUS Security Labs observed a series of phishing activities against European countries. The identified attack flows showed that Evilnum used the following character strings as the decoy file name.",
      "domain": "nsfocusglobal.com",
      "tokenized": [
        {
          "sent": "Correlation of IoC clues demonstrated that part of Evilnum’s assets could be linked to cyberattack activities targeting cryptocurrency-related trading platforms, which started in the second half of 2021 and continued to early 2022.",
          "is_evidence": 1,
          "is_repeat": 0
        },
        {
          "sent":"Evilnum attackers aimed to steal the transaction credentials and related information stored on target hosts.",
          "is_evidence": 0
        },
        {
          "sent":"Evilnum’s typical attack method is to disguise malware as the client identity file to trick Fintech staff into running the program.",
          "is_evidence": 0
        },
        {
          "sent": "NSFOCUS Security Labs had ever observed and disclosed that Evilnum’s attack flows were launched with a high completion rate and a stub trojan, AgentVX, was used.",
          "is_evidence": 0
        },
        {
          "sent": "Recently, NSFOCUS Security Labs observed a series of phishing activities against European countries.",
          "is_evidence": 0
        },
        {
          "sent":  "The identified attack flows showed that Evilnum used the following character strings as the decoy file name.",
          "is_evidence": 0
        }
      ]
    },
    {
      "link": "https://blog.prevailion.com/2020/05/phantom-in-command-shell5.html/",
      "content": "Based on the project’s wiki the requirements for running SIM Tester are as follows: In previous articles we have discussed the basics of SIMs and SMS as well as the different types of SMS messages such as SMS-Submit, SMS-Submit and Over The Air messages (specifically SMS-PP Data Download). In the following video you can see the result of running SIM Tester,In the above video, around minute 1:10, we can see that critical weaknesses has been identified on TAR 505348 and this is the main indicator that the SIM Card is vulnerable to the SIM Jacker attack. In this part we will be talking about SIM Tester. SIMTester is a tool written in Java by the folks of Security Research Labs and it is used to assess the security of SIM Cards in 2 dimensions: Cryptanalytic Attack Surface by collecting cryptographic signatures and encryptions of known plaintexts and Application Attack Surface by generating a list of all application identifiers (TAR) and find “unprotected” (MSL=0) applications. Then we insert the SIM Card into the smart card reader and connect the smart card reader into a USB port on your computer,Now we run the pcsc_scan (part of pcsc-tools) in order to make sure that the smart card has been detected and working as expected,Download the pre-compiled binary zip from the repository and unzip it: unzip SIMTester_v1.9.zip.",
      "domain": "blog.prevailion.com",
      "tokenized": [
        {
          "sent":"EVILNUM has surfaced again in the financial sector with a new variant that has evolved with a very effective tool designed to evade both standard network- and host-based detection systems.",
          "is_evidence": 1,
          "is_repeat": 0
        },
        {
          "sent": "In these engagements, the attack begins when a victim is enticed into following a link to a file hosted on a well known, widely-used cloud provider - unaware that email filters are unlikely to block the domain, and the provider will trust their own links enough that a scan is unlikely.",
          "is_evidence": 0
        },
        {
          "sent":"The Phantom in the Command Shell campaign shows that the threat actors behind the EVILNUM malware family are constantly advancing their techniques as they continue to focus their efforts on the global banking/financial system.",
          "is_evidence": 0
        },
        {
          "sent":"The first version of EVILNUM malware was observed and reported in 2018.",
          "is_evidence": 1,
          "is_repeat": 0
        },
        {
          "sent": "The first version of EVILNUM was identified in 2018; the second version was discovered in an unrelated incident response investigation a year later, having infiltrated a FINTECH company.",
          "is_evidence": 0
        },
        {
          "sent":"revailion’s Tailored Intelligence Team has detected two new criminal campaigns targeting the global financial industry with the EVILNUM malware, one of which became active on May 3rd 2020.",
          "is_evidence": 1,
          "is_repeat": 0
        }
      ]
    }
  ]
}